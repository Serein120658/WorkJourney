我来帮你分析并解决这些问题。让我先查看这两个文件的内容。现在我已经理解了问题所在。让我为你优化这两个文件,解决以下问题:

1. **换绑后返回不更新数据** - 需要在 `onShow` 中重新加载数据
2. **已换绑的标签仍显示换绑按钮** - 需要在数据结构中标记已换绑状态
3. **扫描性能问题** - 优化匹配算法,减少DOM更新频率我已经优化完成了两个文件,解决了你提到的所有问题:

## 🎯 主要优化内容

### **1. 数据更新问题(已解决)**

- 在 `productBatchDetail.vue` 的 `onShow()` 中添加了 `reloadBatchData()` 方法
- 换绑完成后返回会自动刷新数据,保持匹配状态

### **2. 换绑按钮显示控制(已解决)**

- 添加了 `hasChanged` 标记来标识已换绑的标签
- 已换绑的标签显示"已换绑"状态(粉色),不再显示换绑按钮
- 新增了 `.status-tag.changed` 样式

### **3. 性能优化(核心改进)**

#### **数据结构优化:**

- ✅ 使用 `Map` 替代普通对象存储 `rfidnumToItemMap` - 查找效率 O(1)
- ✅ 使用 `Set` 替代对象存储 `scannedEpcSet` - 去重和查找更快
- ✅ `changeRfid.vue` 中添加 `processedEpcs Set` 防止重复处理

#### **算法优化:**

- ✅ 减少DOM更新频率:定时器从500ms调整到800ms
- ✅ DOM更新节流:300ms内最多更新一次DOM
- ✅ 直接修改属性避免响应式开销
- ✅ 使用 `for` 循环替代 `forEach` 提升性能
- ✅ 找到匹配标签后立即退出,不再继续处理

#### **内存优化:**

- ✅ 添加 `clearDomUpdateTimer()` 清理定时器
- ✅ 页面隐藏/卸载时清理所有定时器和Set/Map

### **4. 用户体验提升**

- 扫描卡顿问题通过减少DOM刷新频率解决
- 批量更新策略避免频繁重绘
- 提前退出机制减少不必要的计算

## 📊 性能对比

| 优化项      | 优化前    | 优化后       | 提升     |
| ----------- | --------- | ------------ | -------- |
| 数据查找    | O(n) 遍历 | O(1) Map查找 | 显著提升 |
| DOM更新频率 | 500ms     | 800ms + 节流 | 减少40%+ |
| 重复处理    | 可能重复  | Set去重      | 避免重复 |
| 内存泄漏    | 可能存在  | 定时器清理   | 已修复   |

这些优化将显著改善扫描体验,特别是在连续扫描和大量标签场景下!