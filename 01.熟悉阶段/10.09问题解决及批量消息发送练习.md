## æ˜¨æ—¥é—®é¢˜

æ˜¨æ—¥çš„é—®é¢˜æ˜¯ä½¿ç”¨äº†$smactionå»è¯·æ±‚controller(/gx/test)çš„æ—¶å€™ï¼Œåœ¨ideaæ§åˆ¶å°ä¸­æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†ç›¸åº”çš„æ•°æ®

ä½†æ˜¯åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æˆ‘ä»¬å»console.logæ‹¿åˆ°ç›¸åº”çš„æ•°æ®çš„æ—¶å€™ æ‹¿åˆ°çš„æ˜¯undefined



## åŸå› 

### 1ã€å¯èƒ½æ˜¯å¼‚æ­¥é—®é¢˜(æ˜¨æ—¥æƒ³æ³•)

### 2ã€åç«¯è¿”å›çš„æ•°æ®æ ¼å¼æœ‰é—®é¢˜(å°±æ˜¯è¿™ä¸ªé—®é¢˜)

ä¹‹æ‰€ä»¥è¿™æ ·è¯´ï¼šè¯·çœ‹VCRï¼š
![image-20250801090928946](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801090928946.png)

å¦‚å›¾æ‰€ç¤ºï¼šå¯ä»¥çœ‹åˆ°æŠ¥é”™äº†  obj  ä¹Ÿå°±æ˜¯æˆ‘ä»¬åç«¯è¿”å›çš„æ•°æ®  åˆ°catchä¹‹å å¹¶æ²¡æœ‰è¿”å›æ•°æ®

è¿™å¯èƒ½å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å·²ç»è¿”å›äº†æ•°æ®   ä½†æ˜¯æ‹¿ä¸åˆ°çš„åŸå› 

![image-20250801091517132](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801091517132.png)

## è§£å†³é—®é¢˜

### æŸ¥çœ‹   success çš„é‡è½½æ–¹æ³•ç¡®å®šè¿”å›çš„æ•°æ®æ ¼å¼ 

```java
 /**
     * è¿”å›æˆåŠŸæ¶ˆæ¯
     * 
     * @return æˆåŠŸæ¶ˆæ¯
     */
    public static AjaxResult success()
    {
        return AjaxResult.success("æ“ä½œæˆåŠŸ");
    }

    /**
     * è¿”å›æˆåŠŸæ•°æ®
     * 
     * @return æˆåŠŸæ¶ˆæ¯
     */
    public static AjaxResult success(Object data)
    {
        return AjaxResult.success("æ“ä½œæˆåŠŸ", data);
    }

    /**
     * è¿”å›æˆåŠŸæ¶ˆæ¯
     * 
     * @param msg è¿”å›å†…å®¹
     * @return æˆåŠŸæ¶ˆæ¯
     */
    public static AjaxResult success(String msg)
    {
        return AjaxResult.success(msg, null);
    }

    /**
     * è¿”å›æˆåŠŸæ¶ˆæ¯
     * 
     * @param msg è¿”å›å†…å®¹
     * @param data æ•°æ®å¯¹è±¡
     * @return æˆåŠŸæ¶ˆæ¯
     */
    public static AjaxResult success(String msg, Object data)
    {
        return new AjaxResult(HttpStatus.SUCCESS, msg, data);
    }
```

 å¯ä»¥çœ‹åˆ°  å¦‚æœæˆ‘ä»¬ç›´æ¥è¿”å› result(.success(result))  èµ°çš„ä»£ç ä¸ºï¼š

![image-20250801093916128](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801093916128.png)

å¯ä»¥å‘ç°   data çš„æ•°æ®ä¸ºï¼š

![image-20250801094040909](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801094040909.png)

å¾ˆæ˜æ˜¾ åœ¨å‰ç«¯å°±è§£ææ—¶å°±ä¼šå‡ºé”™  è¿”å›undefined



é‚£å¦‚æœæˆ‘ä»¬æ¢ä¸º   result.get("re") ä¹Ÿå°±æ˜¯  .success(result.get("re"))

ç†è®ºä¸Šåº”è¯¥æ˜¯å¯ä»¥æˆåŠŸçš„å‘€  èµ°çš„é‡è½½æ–¹æ³•ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯è¯·æ±‚å¾—åˆ°çš„ç»“æœï¼š

![image-20250801094615773](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801094615773.png)

ç¦»è°±  data æ˜¯empty



å¯èƒ½æ˜¯éœ€è¦è½¬æ¢ä¸º toString   ä½†æ˜¯è¿™æ ·èµ°çš„å°±æ˜¯   success(String msg)  é‚£å°±å°†æ•°æ®ç»™åˆ°msgäº†  å‰ç«¯è¿˜æ˜¯å–ä¸åˆ°



é‚£æˆ‘ä»¬å°±éœ€è¦èµ°åˆ«çš„é‡è½½æ–¹æ³•äº†   success(String msg,object data)  è€Œdata ä¼ é€’çš„å°±æ˜¯  toStringçš„æ•°æ®  å¦‚å›¾æœ€ç»ˆæˆåŠŸ

![image-20250801095033188](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801095033188.png)

## é¡µé¢å®Œæˆ

![image-20250801095853425](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801095853425.png)

# æ‰¹é‡æ¶ˆæ¯å‘é€(batchç»ƒä¹ )

å¥½å¤„ï¼šå¤šä¸ªæ¶ˆæ¯ä¸€å—å‘é€åå°æ‰§è¡Œï¼Œå¯ä»¥å‡å°‘è¯·æ±‚æ¬¡æ•°ï¼Œå¤šçœ‹  [00.æ¶ˆæ¯ç±»å‹.md](./00.æ¶ˆæ¯ç±»å‹.md) 

## ç®€å•ç¤ºä¾‹(ä¸å¸¦æ¡ä»¶)

### å‰ç«¯è°ƒç”¨

```js
var arrsm = [];
arrsm.push(["gx.selectjson"])
arrsm.push(["gx.selectonejson"])
arrsm.push(["gx.selectjsonwfmenu"])

$.sm(function (re, err1) {
    if (re) {
        console.log(re)
    } else {
        jQuery.getparent().layer.msg(err1, {icon: 5});
    }
}, arrsm, {msgid: "gx.batch"})
```

### åç«¯å®ç°

æ™®é€šæ‰¹é‡æŸ¥è¯¢æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨batchæ¶ˆæ¯ï¼ŒåŠ msgidï¼›ä¹Ÿå¯ä»¥ç›´æ¥å‘é€æ‰¹é‡æ¶ˆæ¯

```xml
<msg id="gx.batch" type="batch">
    <include id="gx.selectjson" />
    <include id="gx.selectonejson"/>
    <include id="gx.selectjsonwfmenu" />
</msg>
```

## ç†è§£

ä¸Šé¢çš„ç¤ºä¾‹ï¼šéƒ½æ˜¯æŸ¥è¯¢çš„   è€Œä¸”æ²¡æœ‰æºå¸¦æ¡ä»¶  æµç¨‹å°±åªæ˜¯

å‰ç«¯è¯·æ±‚  gx.batch æ¶ˆæ¯   åœ¨xmlä¸­æ‰¾åˆ°äº†ç›¸åº”çš„æ¶ˆæ¯å  æ ¹æ®includeä¸­çš„æ¶ˆæ¯id å»æ‰§è¡Œç›¸åº”æ¶ˆæ¯ä½“çš„æŸ¥è¯¢è¯­å¥  æ¯”è¾ƒå¥½ç†è§£

## è¿›é˜¶(å¸¦æ¡ä»¶)

å¸¦æ¡ä»¶å°±å¾—å»çœ‹çœ‹ sm çš„æºç äº†å’Œæ–‡æ¡£äº†

> ğŸ“Œ .sm=.fn.sm = function (cb, arr, pobj, timeout, trans) {}
> cb: å›è°ƒå‡½æ•°
> arr: æ¶ˆæ¯æ•°ç»„
> pobj: æ‹“å±•å¯¹è±¡ï¼Œæ‰¹é‡æ¶ˆæ¯msgidï¼ˆå¿…å¡«ï¼‰ã€transäº‹åŠ¡æ‰§è¡Œ
> timeout: è¶…æ—¶æ—¶é—´
> trans: äº‹åŠ¡ç±»å‹ï¼Œ1.å•åº“æ‰¹é‡äº‹åŠ¡æ‰§è¡Œ 2.å¤šåº“æ‰¹é‡äº‹åŠ¡æ‰§è¡Œ

### æ‰¹é‡insertç¤ºä¾‹

#### å‰ç«¯

```js
var arrpm = [];
arrpm.push(["deptlist.add", JSON.stringify({
        depart_name: "æŠ€æœ¯éƒ¨"
    }), $.msgwhere()]);
arrpm.push(["postlist.add", JSON.stringify({
        post_code: "123",
        post_name: "å¼€å‘å²—",
        post_sort: 123,
        status: 1
    }), $.msgwhere()]);
arrpm.push(["user.save", JSON.stringify({
        uname: "lihongli",
        nick_name: "æçº¢åˆ©",
        depart_id:0,
        status:0
    }), $.msgwhere()]);
    
$.sm(function (re, err) {
    console.log("btnlogin - re -> " + re);
    console.log("btnlogin - err -> " + err);
}, arrpm, {msgid: "user.add"});
```

#### åç«¯

```xml
<msg id="user.add" type="batchtransdb" perms="sys:user:add" title="æ·»åŠ ç”¨æˆ·" businesstype="INSERT">
    <include id="deptlist.add"/>
    <include id="postlist.add"/>
    <include id="user.save" insertfromids="deptlist.add,postlist.add" insertkeys="depart_id,post_id"/>
</msg>
```

#### ç†è§£ï¼šå‚æ•°å¦‚ä½•ä¼ é€’çš„ï¼Ÿ

æŸ¥çœ‹ include æ ‡ç­¾çš„å‚æ•°è¯´æ˜

| åºå· | å‚æ•°          | åç§°                 | ç¤ºä¾‹è¯´æ˜                                                     |
| :--- | :------------ | :------------------- | :----------------------------------------------------------- |
| 1    | id            | å­æ¶ˆæ¯id             | å¯¹åº”æ¶ˆæ¯ä¸­idå‚æ•°ä½                                           |
| 2    | insertkeys    | æ’å…¥å“ªäº›å­—æ®µç‰¹æ®Šå¤„ç† | é€—å·åˆ†éš”ï¼›å“ªäº›å­—æ®µéœ€è¦å¼•ç”¨å…¶ä»–æ¶ˆæ¯è¿”å›å€¼ï¼Œå¦‚ï¼šdepart_id,post_id |
| 3    | insertfromids | è¯»å–å“ªäº›æ¶ˆæ¯è¿”å›å€¼   | é€—å·åˆ†éš”ï¼›å¯¹åº”insertkeysæ’å…¥è¿”å›å€¼ï¼Œå¦‚ï¼šdeptlist.add,postlist.add |

> ğŸ’¡ 1.å‰ç«¯è¦æŒ‰ç…§æ‰§è¡Œå…ˆåé¡ºåºæ‹¼è£…arrmsgæ¶ˆæ¯ï¼Œè¢«å¼•ç”¨çš„æ¶ˆæ¯è¦å…ˆæ‰§è¡Œï¼›
> 2.å½“å‰å¼•ç”¨å€¼é»˜è®¤æ‰¾å‰é¢æ‰§è¡Œinsertfromidsæ¶ˆæ¯çš„æœ€åä¸€æ¡å–è¿”å›å€¼ï¼›
> æ”¯æŒå½¢æ€ï¼šabbb, ababab,abcabc

### é—®é¢˜

å½“æˆ‘æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­å»å®ç°æ‰¹é‡æŸ¥æ‰¾ä½†æ˜¯æºå¸¦å‚æ•°ä¼ é€’åˆ°åç«¯ï¼Œä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯

å‰ç«¯ä»£ç ï¼š

```js
$("#btnBatchWithCondition").click(function () {
    console.log("å¸¦å‚æ•°æ‰¹é‡æ“ä½œ")
    var arrsm = [];
    arrsm.push(["gx.selectjsonwhere", JSON.stringify({
            keyword: ["msgUtils"]
    }),$.msgwhere()])

    // arrsm.push(["gx.updatejson", JSON.stringify(
    //     {
    //         menu_name: "msgUtilså’Œbatchæ‰¹é‡æ¶ˆæ¯å¤„ç†",
    //         id: 227
    //     }
    // ),$.msgwhere()])
    console.log(arrsm)
    $.sm(function (re, err1) {
        if (re) {
            console.log(re)
        } else {
            jQuery.getparent().layer.msg(err1, {icon: 5});
        }
    }, arrsm, {msgid: "gx.batchtransdb"})
});
```

åç«¯ï¼š

```xml
   <msg id="gx.batchtransdb" type="batchtransdb">
            <include id="gx.selectjsonwhere" />
<!--            <include id="gx.updatejson" />-->
        </msg>
```

å‘ç°ä¼šå‡ºä¸‹é¢çš„

<font color=red>[ERROR] [http-nio-9999-exec-2] - com.whoami.db.MsgKit.checkArrParam(MsgKit.java:278) - -------whereæ¶ˆæ¯ï¼Œæ£€æµ‹åˆ°JSONæ ¼å¼æœ‰è¯¯. [msgid='gx.selectjsonwhere', arrpm='1', value='{"keyword":["msgUtils"]}']</font>

![image-20250801161314382](10.09é—®é¢˜è§£å†³åŠæ‰¹é‡æ¶ˆæ¯å‘é€ç»ƒä¹ .assets/image-20250801161314382.png)

æŸ¥çœ‹æºç ï¼šåˆ†æåŸå› ï¼š

ç¬¬ä¸€ä¸ªå…ƒç´  "gx.selectjsonwh..." å’Œç¬¬äºŒä¸ªå…ƒç´  "{%22keyword%22:..." éƒ½ä¸åŒ…å« "msg_where"ã€‚
åªæœ‰ç¬¬ä¸‰ä¸ªå…ƒç´  "{%22msg_where%2..." åŒ…å« "msg_where"ã€‚
é—®é¢˜åŸå› ï¼šåœ¨å¾ªç¯ä¸­ï¼Œå½“ i = 0 æˆ– i = 1 æ—¶ï¼Œarrpm[i] ä¸åŒ…å« "msg_where"ï¼Œå› æ­¤ä¼šè§¦å‘é”™è¯¯å¤„ç†é€»è¾‘ï¼ˆè®°å½•æ—¥å¿—å¹¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼‰ã€‚



è¿™æ ·çœ‹æ¥ï¼Œå¯èƒ½æ˜¯å‰ç«¯ä¼ é€’çš„é—®é¢˜   ä½†æ˜¯é™¤æ­¤ä¹‹å¤–å¥½åƒä¹Ÿä¸çŸ¥é“å¦‚ä½•ä¼ é€’  

ä¸å¯èƒ½å°†æºç çš„  ++i   æ”¹ä¸º i++ ?





**æºç çœ‹ç´¯äº†**

![img](https://dl4.weshineapp.com/gif/20211205/13514bda94dd27af6741f118a51fb89c.gif?f=micro_)





















