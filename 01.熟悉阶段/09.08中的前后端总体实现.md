说明：昨日使用了postman去模拟实现了msgutils.sm 与 controller 的结合使用，

但是没有结合用到system.js中的$.smaction



## $.smaction 使用

目标，前端使用$.smaction去请求，将得到的数据渲染出





### 难点

昨日 我们通了后端的，使用postman得到的数据格式如下：

是string类型的   就导致了使用layuitable去渲染表格的时候   数据的处理变艰难起来

这是使用了  selectonejson   消息类型得到了  只有一条且为对象形式

```string
{msg={"code":200,"re":{"dict_type":"w_user_sex","departno":"","length":1,"remark":"用户性别列表","alterid":0,"uid":0,"dict_name":"用户性别","altime":"2024-07-03 06:43:26.305128","lan":"zh","creatime":"2024-07-03 06:43:26.305128","id":1,"isdel":0,"status":"0"}}, code=200}
```

使用   selectjson  消息类型得到的 对象数组

```string
{msg={"code":200,"re":[{"dict_type":"w_show_hide","uid":0,"departno":"","dict_name":"菜单状态","altime":"2024-07-03 06:43:26.305128","lan":"zh","creatime":"2024-07-03 06:43:26.305128","remark":"菜单状态列表","id":2,"alterid":0,"isdel":0,"status":"0"},{"dict_type":"w_job_status","uid":0,"departno":"","dict_name":"任务状态","altime":"2024-07-03 06:43:26.305128","lan":"zh","creatime":"2024-07-03 06:43:26.305128","remark":"任务状态列表","id":4,"alterid":0,"isdel":0,"status":"0"},{"dict_type":"w_notice_status","uid":0,"departno":"","dict_name":"通知状态","altime":"2024-07-03 06:43:26.305128","lan":"zh","creatime":"2024-07-03 06:43:26.305128","remark":"通知状态列表","id":8,"alterid":0,"isdel":0,"status":"0"},{"dict_type":"w_common_status","uid":0,"departno":"","dict_name":"系统状态","altime":"2024-07-03 06:43:26.305128","lan":"zh","creatime":"2024-07-03 06:43:26.305128","remark":"登录状态列表","id":10,"alterid":0,"isdel":0,"status":"0"}]}, code=200}
```



而使用layuitable 需要的数据只是"re"中的数据  且要求为数组才能渲染



那就得想方法对数据进行处理了

```js
 function parseJavaMapData(data, targetField) {
            console.log("原始数据:", data);
            console.log("数据类型:", typeof data);

            // 如果已经是对象格式
            if (data && typeof data === 'object' && !Array.isArray(data)) {
                if (targetField && data[targetField]) {
                    return data[targetField];
                }
                if (data.msg && data.msg[targetField || 're']) {
                    return data.msg[targetField || 're'];
                }
                return data;
            }

            // 处理Java Map字符串格式
            if (typeof data === 'string' && data.includes('=')) {
                try {
                    // 方法1: 提取msg=后面的JSON部分
                    var msgMatch = data.match(/msg=(\{.*?\}),?\s*code=/);
                    if (msgMatch && msgMatch[1]) {
                        var msgData = JSON.parse(msgMatch[1]);
                        return msgData[targetField || 're'];
                    }

                    // 方法2: 直接提取目标字段 - 支持数组格式
                    if (targetField) {
                        // 匹配对象格式: "re":{...}
                        var fieldMatch = data.match(new RegExp('"' + targetField + '":({[^}]*})'));
                        if (fieldMatch && fieldMatch[1]) {
                            return JSON.parse(fieldMatch[1]);
                        }

                        // 匹配数组格式: "re":[...]
                        var arrayMatch = data.match(new RegExp('"' + targetField + '":(\\[[^\\]]*\\])'));
                        if (arrayMatch && arrayMatch[1]) {
                            return JSON.parse(arrayMatch[1]);
                        }
                    }
                } catch (e) {
                    console.error("Java Map格式解析失败:", e);
                }
            }

            // 尝试直接JSON解析
            if (typeof data === 'string') {
                try {
                    var parsed = JSON.parse(data);
                    if (targetField && parsed[targetField]) {
                        return parsed[targetField];
                    }
                    if (parsed.msg && parsed.msg[targetField || 're']) {
                        return parsed.msg[targetField || 're'];
                    }
                    return parsed;
                } catch (e) {
                    console.error("JSON解析失败:", e);
                }
            }

            return null;
        }

        // 数组转换处理方法
        function convertToTableData(reData) {
            if (!reData) {
                return [];
            }

            // 如果已经是数组，直接返回
            if (Array.isArray(reData)) {
                console.log("数据已是数组格式:", reData);
                return reData;
            }

            // 如果是单个对象，转换为数组
            if (typeof reData === 'object') {
                console.log("单个对象转数组:", reData);
                return [reData];
            }

            console.warn("未知数据格式:", reData);
            return [];
        }
```







```
<!-- JavaScript 示例 - LayUI 风格获取值 -->
<script>
    // 模拟 LayUI 的使用方式
    function initPage() {
        // 搜索按钮事件
        document.getElementById('searchBtn').addEventListener('click', function() {
            // LayUI 风格的获取值方式
            var menuName = $("#menuName").val();  // 获取菜单名输入框的值
            var status = $("#status").val();      // 获取状态下拉框的值

            // 传递给 JavaScript 的方式
            console.log('搜索参数:', {
                menuName: menuName,
                status: status
            });

            // 模拟调用您的 gx_msgUtils.js 中的方法
            if (window.searchMsgUtils) {
                window.searchMsgUtils(menuName, status);
            }
        });

        // 重置按钮事件
        document.getElementById('resetBtn').addEventListener('click', function() {
            $("#menuName").val('');  // LayUI 风格清空输入框
            $("#status").val('');    // LayUI 风格清空下拉框
        });

        // msgUtils按钮事件
        document.getElementById('btnMsgUtils').addEventListener('click', function() {
            // LayUI 风格获取值
            var menuName = $("#menuName").val();
            var status = $("#status").val();

            // 获取搜索条件并传递
            var searchParams = {
                menuName: menuName,
                status: status
            };

            console.log('加载表格数据:', searchParams);
            // 这里可以调用您的表格加载方法
        });
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initPage);

    // 如果您需要在 gx_msgUtils.js 中使用，可以这样写：
    function getSearchValues() {
        var menuName = $("#menuName").val();  // 获取菜单名
        var status = $("#status").val();      // 获取状态

        return {
            menuName: menuName,
            status: status
        };
    }
</script>
```

### 不知道如何解决这个异步问题

后端返回了数据，但是前端拿不到

![image-20250731180535348](09.08中的前后端总体实现.assets/image-20250731180535348.png)





早上完整了架构

下午页面实现  但是遇到了一个解决不了的问题   打算明天问问











