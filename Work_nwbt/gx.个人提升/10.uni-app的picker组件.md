# uni-app Picker 组件完全指南

## 概述

Picker 是 uni-app 中用于从底部弹起的滚动选择器组件。它支持五种不同的选择模式，通过 `mode` 属性来区分：

- **selector** - 普通选择器（默认）
- **multiSelector** - 多列选择器
- **time** - 时间选择器
- **date** - 日期选择器
- **region** - 省市区选择器

这个组件在不同平台上的 UI 表现会有所差异。例如，某些平台（如百度、支付宝小程序的 Android 端）是从中间弹出的，有些平台支持循环滚动，还有些平台没有取消按钮（如 App-iOS 端）。但这些差异不会影响功能的正常使用。

## 日期选择器（mode="date"）

### 平台差异与统一方案

日期选择器在使用时需要特别注意一个重要的特性：默认情况下，App 端和 H5 端（PC 版 Chrome 以及 PC 版 Firefox）会调用操作系统的原生日期选择控件。这意味着：

- 在 **Android 设备**上，**会显示系统原生的日期选择弹窗**

  ![image-20251124142152852](10.uni-app的picker组件.assets/image-20251124142152852.png)

- 在 **微信小程序**中，显示底部滚动选择器

- 在 **iOS 设备**上，显示 iOS 原生的滚轮选择器

如果你希望在所有平台上都使用统一的滚动选择器样式，**关键在于配置 `fields` 参数**。一旦设置了这个参数，picker 就会使用统一的展示方式，而不再调用系统原生控件。

![image-20251124142311960](10.uni-app的picker组件.assets/image-20251124142311960.png)

### 基本使用示例

让我们看一个实际的例子。假设你要创建一个出库日期选择功能：

```vue
<template>
  <view class="date-selector">
    <picker 
      mode="date" 
      :value="selectedDate" 
      fields="day"
      @change="onDateChange">
      <view class="date-display">
        <text>{{ selectedDate }}</text>
      </view>
    </picker>
  </view>
</template>

<script>
export default {
  data() {
    return {
      selectedDate: ''
    }
  },
  onLoad() {
    // 初始化为当前日期
    const now = new Date();
    this.selectedDate = this.formatDate(now);
  },
  methods: {
    formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },
    onDateChange(e) {
      this.selectedDate = e.detail.value;
      console.log('选择的日期:', this.selectedDate);
    }
  }
}
</script>
```

在这个例子中，`mode="date"` 指定了使用日期选择器模式，`fields="day"` 确保了选择器的精度为天，并且在所有平台上使用统一的滚动选择器 UI。

### fields 参数详解

`fields` 参数决定了日期选择器的精度，它有三个可选值：

| 值      | 说明           | 显示内容               |
| ------- | -------------- | ---------------------- |
| `year`  | 选择器粒度为年 | 只显示年份             |
| `month` | 选择器粒度为月 | 显示年份和月份         |
| `day`   | 选择器粒度为天 | 显示年月日（完整日期） |

#### 重要提示：start 和 end 属性的限制

**配置了 `fields` 参数后，`start` 和 `end` 这两个用于限制日期范围的属性在 App 端将不再生效。** 这是一个重要的平台差异，在实际开发中需要特别留意。

如果你确实需要限制日期范围，有两种解决方案：

1. **不使用 `fields` 参数**（此时会调用系统原生控件，start 和 end 有效）
2. **在日期选择后通过 JavaScript 进行验证和过滤**

示例：通过 JavaScript 验证日期范围

```javascript
onDateChange(e) {
  const selectedDate = new Date(e.detail.value);
  const minDate = new Date('2023-01-01');
  const maxDate = new Date('2025-12-31');
  
  if (selectedDate < minDate || selectedDate > maxDate) {
    uni.showToast({
      title: '请选择2023-2025年之间的日期',
      icon: 'none'
    });
    return;
  }
  
  this.selectedDate = e.detail.value;
}
```

### 常用属性说明

#### value

- **类型**：String
- **格式**：`YYYY-MM-DD`
- **说明**：表示当前选中的日期，如 `2025-11-19`

#### disabled

- **类型**：Boolean
- **默认值**：false
- **说明**：是否禁用选择器

## 时间选择器（mode="time"）

时间选择器用于选择具体的时间点，格式为 `hh:mm`（24小时制）。

### 基本使用

```vue
<template>
  <picker 
    mode="time" 
    :value="selectedTime" 
    start="09:00"
    end="18:00"
    @change="onTimeChange">
    <view>营业时间：{{ selectedTime }}</view>
  </picker>
</template>

<script>
export default {
  data() {
    return {
      selectedTime: '09:00'
    }
  },
  methods: {
    onTimeChange(e) {
      this.selectedTime = e.detail.value;
    }
  }
}
</script>
```

### 属性说明

- **value**：表示选中的时间，格式为 `hh:mm`，如 `09:30`、`14:45`
- **start**：有效时间范围的开始（注意：**App 端不支持**）
- **end**：有效时间范围的结束（注意：**App 端不支持**）

时间选择器在 App 端同样会调用系统原生的时间选择控件，提供了原生的用户体验。

## 普通选择器（mode="selector"）

普通选择器适用于从预定义的选项中选择一个值，比如选择城市、商品类别等。

### 基础用法

```vue
<template>
  <picker 
    mode="selector"
    :range="cities" 
    :value="cityIndex" 
    @change="onCityChange">
    <view>当前城市：{{ cities[cityIndex] }}</view>
  </picker>
</template>

<script>
export default {
  data() {
    return {
      cities: ['北京', '上海', '广州', '深圳'],
      cityIndex: 0
    }
  },
  methods: {
    onCityChange(e) {
      this.cityIndex = e.detail.value;
      console.log('选择了:', this.cities[e.detail.value]);
    }
  }
}
</script>
```

### 使用对象数组

当选项是对象数组时，可以使用 `range-key` 属性来指定显示哪个字段：

```vue
<template>
  <picker 
    mode="selector"
    :range="products" 
    range-key="name"
    :value="productIndex" 
    @change="onProductChange">
    <view>商品：{{ products[productIndex].name }}</view>
  </picker>
</template>

<script>
export default {
  data() {
    return {
      products: [
        { id: 1, name: '苹果', price: 10 },
        { id: 2, name: '香蕉', price: 8 },
        { id: 3, name: '橙子', price: 12 }
      ],
      productIndex: 0
    }
  },
  methods: {
    onProductChange(e) {
      this.productIndex = e.detail.value;
      const selected = this.products[e.detail.value];
      console.log('选择了:', selected.name, '价格:', selected.price);
    }
  }
}
</script>
```

### 属性说明

- **range**：选择器的数据源，可以是字符串数组或对象数组
- **range-key**：当 range 是对象数组时，指定要显示的对象属性名
- **value**：当前选中项的索引（从 0 开始）

## 多列选择器（mode="multiSelector"）

多列选择器允许同时选择多个维度的数据，比如选择省市区、时间的时分秒等。它使用二维数组来定义数据。

### 平台支持说明

⚠️ **重要**：支付宝小程序不支持多列选择器。如果你的应用需要在支付宝平台运行，应该使用 `picker-view` 组件来实现类似功能。

### 基础示例

```vue
<template>
  <picker 
    mode="multiSelector"
    :range="multiArray" 
    :value="multiIndex" 
    @change="onMultiChange"
    @columnchange="onColumnChange">
    <view>
      选择的日期：{{ multiArray[0][multiIndex[0]] }}年 {{ multiArray[1][multiIndex[1]] }}月
    </view>
  </picker>
</template>

<script>
export default {
  data() {
    return {
      multiArray: [
        ['2023', '2024', '2025'],
        ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12']
      ],
      multiIndex: [1, 0] // 默认选择 2024年01月
    }
  },
  methods: {
    onMultiChange(e) {
      this.multiIndex = e.detail.value;
      console.log('最终选择:', this.multiIndex);
    },
    onColumnChange(e) {
      console.log('改变的列:', e.detail.column);
      console.log('改变的值:', e.detail.value);
      // 这里可以实现联动效果
    }
  }
}
</script>
```

### 实现联动选择

`@columnchange` 事件在某一列的值发生改变时触发，这在需要实现联动选择（比如根据省份动态加载城市）时非常有用：

```javascript
onColumnChange(e) {
  const column = e.detail.column; // 改变的列
  const value = e.detail.value;   // 改变后的值
  
  // 第一列（省份）改变时，更新第二列（城市）
  if (column === 0) {
    const newCities = this.getCitiesByProvince(value);
    // 注意：需要使用 $set 来触发响应式更新
    this.$set(this.multiArray, 1, newCities);
    // 重置第二列的选择
    this.multiIndex[1] = 0;
  }
}
```

### 重要注意事项

#### Vue 响应式限制

直接通过索引修改数组元素（如 `this.multiIndex[0] = 1`）不会触发视图更新。正确的做法是：

```javascript
// ❌ 错误做法
this.multiIndex[0] = 1;

// ✅ 正确做法 1：使用 $set
this.$set(this.multiIndex, 0, 1);

// ✅ 正确做法 2：重新赋值整个数组
this.multiIndex = [1, 0];
```

## 事件处理

### @change 事件

在用户确认选择时触发，事件对象的 `detail.value` 包含了选中的值：

```javascript
onDateChange(e) {
  console.log('选中的值:', e.detail.value);
  // 日期格式：'2025-11-19'
  // 时间格式：'14:30'
  // 普通选择器：索引值，如 2
  // 多列选择器：索引数组，如 [1, 0]
}
```

### @cancel 事件

在用户取消选择或点击遮罩层时触发（快手小程序不支持）：

```vue
<picker 
  mode="date" 
  :value="date" 
  @change="onChange"
  @cancel="onCancel">
  <view>选择日期</view>
</picker>

<script>
export default {
  methods: {
    onChange(e) {
      console.log('确认选择');
    },
    onCancel() {
      console.log('取消选择');
    }
  }
}
</script>
```

### 数据格式说明

在处理日期和时间选择时，返回的值总是字符串格式：

- **日期格式**：`YYYY-MM-DD`，如 `2025-11-19`
- **时间格式**：`hh:mm`，如 `14:30`

你可以直接使用这些字符串，或者将它们转换为 Date 对象进行进一步处理：

```javascript
onDateChange(e) {
  const dateString = e.detail.value; // '2025-11-19'
  const dateObj = new Date(dateString);
  console.log('日期对象:', dateObj);
}
```

## 实际开发建议

### 统一跨平台体验

如果你的应用需要在多个平台上运行，建议使用 `fields` 参数来统一日期选择器的 UI 表现：

```vue
<!-- ✅ 推荐：所有平台统一样式 -->
<picker mode="date" :value="date" fields="day" @change="onChange">

<!-- ❌ 不推荐：不同平台样式不一致 -->
<picker mode="date" :value="date" @change="onChange">
```

这样可以确保用户在不同平台上获得一致的体验。

### 日期范围验证

当使用了 `fields` 参数后，应该在 JavaScript 层面进行日期范围验证：

```javascript
onDateChange(e) {
  const selected = new Date(e.detail.value);
  const today = new Date();
  
  // 示例：只允许选择今天及之后的日期
  if (selected < today.setHours(0, 0, 0, 0)) {
    uni.showToast({
      title: '不能选择过去的日期',
      icon: 'none'
    });
    return;
  }
  
  this.selectedDate = e.detail.value;
}
```

### 处理滚动动画

Picker 组件的滚动动画完成需要时间。如果用户在内容还在滚动时就点击确定，数据可能无法及时更新。虽然这是所有平台的共同特性，但在设计用户体验时仍然值得考虑：

- 提供清晰的视觉反馈，让用户知道当前选择的值
- 考虑添加"确认"二次确认步骤，特别是在重要操作中
- 在必要时可以添加提示文字，引导用户等待滚动停止

### 性能优化建议

对于数据量较大的选择器（如包含上千个选项），建议：

1. 使用懒加载或分页加载数据
2. 考虑使用搜索功能辅助选择
3. 对于复杂的多级联动，可以考虑使用 `picker-view` 组件获得更多控制

## 常见问题

### 为什么日期选择器在不同平台显示不一样？

默认情况下，App 端会调用系统原生控件，而小程序端使用统一的滚动选择器。解决方法是添加 `fields` 参数，强制使用统一样式。

### start 和 end 属性为什么不生效？

当设置了 `fields` 参数后，`start` 和 `end` 在 App 端不再生效。需要通过 JavaScript 在 `@change` 事件中进行日期范围验证。

### 多列选择器如何实现联动？

使用 `@columnchange` 事件监听列的变化，然后动态更新对应的数据数组。记得使用 `$set` 方法来确保响应式更新。

### 为什么修改 multiIndex 不生效？

这是 Vue 的响应式限制。不能直接通过索引修改数组，应该使用 `this.$set(this.multiIndex, index, value)` 或重新赋值整个数组。

## 总结

Picker 组件是 uni-app 中一个功能强大且灵活的选择器组件。通过合理使用不同的 mode 和配置参数，可以满足各种数据选择的需求。关键要点包括：

- 使用 `fields` 参数实现跨平台统一的日期选择器 UI
- 理解 `fields` 参数会影响 `start` 和 `end` 属性的支持
- 注意 Vue 响应式更新的正确方式，特别是在多列选择器中
- 考虑平台差异，如支付宝小程序不支持多列选择器
- 在重要场景中添加适当的验证和用户提示

在开发过程中，建议先在目标平台上进行测试，确保选择器的表现符合预期，然后再进行功能的深度开发。