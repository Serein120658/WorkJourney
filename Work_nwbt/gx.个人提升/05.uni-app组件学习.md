# fsz-modal 模态框组件使用文档

## 应用场景

本次UID小程序在二维码页面，如果没有绑定UID的话，会提示先去绑定UID，后续在专属客服小程序中会使用到，因此提前去了解，以备不时之需。

效果类似：弹出一个模态提示框，提示用户"请先添加UID"，并提供"立即前往"按钮引导用户进行操作。

![image-20251020133644091](05.uni-app组件学习.assets/image-20251020133644091.png)

------

## 组件引入

<font color =  red >说明: 项目中一般都是已经搭建好的，直接引用就可以了，查看项目的结构即可</font>

### 1. 导入组件

```vue
<script>
import fszmodal from "@/components/fsz-modal/fsz-modal.vue"

export default {
  components: {
    fszmodal
  }
}
</script>
```

### 2. 其他相关组件

本示例还使用了二维码和条形码组件：

```vue
import QiyanQrcode from "@/components/qiyan-qrcode/qiyan-qrcode.vue"
import tkiBarcode from "@/components/tki-barcode/tki-barcode.vue"
```

------

## 语法说明

### 基本语法

```vue
<fsz-modal 
  :show="showModal" 
  :title="modalTitle" 
  :buttons="buttonArray"
  :style="customStyle">
  <view class="modal-content">
    <!-- 自定义内容 -->
  </view>
</fsz-modal>
```

### 属性说明

| 属性名  | 类型    | 默认值 | 必填 | 说明                                     |
| ------- | ------- | ------ | ---- | ---------------------------------------- |
| show    | Boolean | false  | 是   | 控制模态框的显示/隐藏状态                |
| title   | String  | ''     | 否   | 模态框标题文本                           |
| buttons | Array   | []     | 否   | 按钮配置数组（一般由父组件控制按钮行为） |
| style   | String  | ''     | 否   | 自定义样式字符串                         |

### Data 数据定义

```javascript
data() {
  return {
    showadd: false,        // 控制模态框显示状态
    buttons: [],           // 按钮配置数组
  }
}
```

### 事件处理

模态框内的按钮点击事件**需要在自定义内容中定义：**

```vue
<view class="buttons">
  <button 
    type="primary" 
    plain="true"
    @click="btnadd()"
    style="font-size: 32rpx; color: #60CABB; text-decoration-line: underline; border: none;">
    立即前往
  </button>
</view>
```

------

## 完整示例代码

### 模板部分

```vue
<template>
  <view>
    <!-- 顶部背景区域 -->
    <view class="top-bgview">
      <image 
        src="/static/image/home/indexbg.png"
        style="width: 100%; height: 700rpx;">
      </image>
      
      <!-- 用户信息展示 -->
      <view style="text-align: center; position: absolute; top: 30rpx; left: 0; right: 0;">
        <view class="weui-cell">
          <image
            src="/static/image/home/img_default.png"
            style="width: 121rpx; height: 121rpx; margin-right: 20rpx; border-radius: 5px;">
          </image>
          <view class="weui-cell__bd" style="align-items: flex-start; flex-direction: column; text-align: left;">
            <view style="font-size: 48rpx; color: #FFFFFF;">
              优爱弟
            </view>
          </view>
        </view>
      </view>
      
      <!-- UID信息面板 -->
      <view style="text-align: center; position: absolute; top: 200rpx; left: 0; right: 0;">
        <view class="weui-cells panel-view">
          <view class="weui-cell__bd">
            <!-- 姓名行 -->
            <view class="weui-cell" style="padding: 15px 15px 5px 15px;">
              <view class="weui-cell__bd weui-flex" style="align-items: center;">
                <view>
                  <text class="grayrtxt">姓名</text>{{ name }}
                </view>
              </view>
              <view class="weui-cell__ft">
                <image 
                  v-if="uidusercount > 1"
                  @click="btnchangeuid()"
                  src="/static/image/home/qiehuan.png" 
                  style="width: 41rpx; height: 41rpx;">
                </image>
              </view>
            </view>
            
            <!-- UID号行 -->
            <view class="weui-cell">
              <view class="weui-cell__bd weui-flex" style="align-items: center;">
                <view>
                  <text class="grayrtxt">UID号</text>
                  <block v-if="mackunionidchar">{{ makechar_unionid }}</block>
                  <block v-else>{{ unionid }}</block>
                  <image 
                    v-if="!mackunionidchar" 
                    src="/static/image/home/documents.png"
                    style="width: 31rpx; height: 31rpx; margin-left: 20rpx;"
                    @click="copyToClipboard(unionid)">
                  </image>
                </view>
              </view>
              <view class="weui-cell__ft" @click="viewunionid()">
                <image 
                  v-if="mackunionidchar"
                  src="/static/image/home/eye_close_fill.png"
                  style="width: 41rpx; height: 41rpx;">
                </image>
                <image 
                  v-else
                  src="/static/image/home/eye_fill.png"
                  style="width: 41rpx; height: 41rpx;">
                </image>
              </view>
            </view>
          </view>
          
          <!-- UID切换弹窗 -->
          <fui-bottom-popup :show="showchangeuid" @close="closePopup()">
            <view class="fui-scroll__wrap">
              <view class="fui-title fui-title__pb"></view>
              <scroll-view scroll-y class="fui-scroll__view">
                <view class="shadow-content1" style="padding: 0; background: #ffffff; border-radius: 24rpx 24rpx 0 0;">
                  <view class="bodyshape-txt" style="padding: 0 40rpx 0 40rpx;">
                    <view class="sel-class">
                      <block v-for="(item, index) in arruid" :key="index">
                        <view class="classlist" @click="setuiddefault(item.id)">
                          <text>{{ item.name }}</text>
                          <label 
                            v-if="item.id == currentuid" 
                            class="radio radio-cell"
                            style="right: 10px; position: absolute;">
                            <view class="radio_style checkbox_style">
                              <radio checked></radio>
                            </view>
                          </label>
                        </view>
                      </block>
                      <view class="classlist current" @click="btnadd()">
                        <text>+ 添加UID</text>
                      </view>
                    </view>
                  </view>
                </view>
              </scroll-view>
            </view>
          </fui-bottom-popup>
          
          <!-- 条形码 -->
          <view class="barcode">
            <tkiBarcode 
              cid="code128"
              :loadMake="false" 
              :opations="opations" 
              :onval="true"
              format="code128"
              :val="barresult" />
          </view>
          
          <!-- 二维码 -->
          <view class="codeimg" style="text-align: center;">
            <QiyanQrcode :text="title1" :size="size"></QiyanQrcode>
          </view>
          
          <!-- 时间显示 -->
          <view class="timetxt">{{ nowtime }}</view>
          
          <!-- 刷新按钮 -->
          <view class="refreshcode weui-flex_center" @click="btnsetqrcode()">
            <image
              src="/static/image/home/reload.png"
              style="width: 25rpx; height: 25rpx; margin-right: 5px;">
            </image>
            刷新二维码
          </view>
        </view>
      </view>
    </view>
    
    <!-- 模态框组件 -->
    <fsz-modal 
      :show="showadd" 
      title="请先添加UID"
      :buttons="buttons" 
      style="font-size: 30rpx;">
      <view class="modal-content">
        <view class="buttons">
          <button 
            type="primary" 
            plain="true"
            @click="btnadd()"
            style="font-size: 32rpx; color: #60CABB; text-decoration-line: underline; border: none;">
            立即前往
          </button>
        </view>
      </view>
    </fsz-modal>
  </view>
</template>
```

### 脚本部分

```javascript
<script>
import fszmodal from "@/components/fsz-modal/fsz-modal.vue"
import QiyanQrcode from "@/components/qiyan-qrcode/qiyan-qrcode.vue"
import tkiBarcode from "@/components/tki-barcode/tki-barcode.vue"
import DigitalCipher from "@/common/DigitalCipher.js"

var moment = require("@/common/moment.min.js");
const app = getApp();

export default {
  data() {
    return {
      showadd: false,              // 控制添加UID模态框显示
      showaddtype: false,
      showguanxi: false,
      tag: "",
      buttons: [],                 // 模态框按钮配置
      name: "",                    // 用户姓名
      unionid: "",                 // UID号
      uidusercount: 0,            // UID用户数量
      showchangeuid: false,       // 控制切换UID弹窗
      arruid: [],                 // UID列表
      title1: "",                 // 二维码内容
      barresult: "0",            // 条形码结果
      opations: {                // 条形码配置
        width: 4,                // 条之间的宽度
        height: 120,             // 高度
        displayValue: true,      // 是否显示文字
        textAlign: "left",       // 文本水平对齐
        textPosition: "bottom",  // 文本垂直位置
        textMargin: 0,          // 条形码和文本间距
        background: "#FFFFFF",   // 背景色
        margin: 0,              // 空白边距
      },
      size: 460,                 // 二维码尺寸
      onval: true,
      nowtime: "",               // 当前时间
      cid: "cid",
      currentuid: 0,             // 当前UID
      macknamechar: true,        // 是否隐藏姓名
      mackunionidchar: true,     // 是否隐藏UID号
      makechar_name: "",         // 隐藏后的姓名
      makechar_unionid: "",      // 隐藏后的UID号
      t: null,                   // 定时器
      ttime: 1 * 60 * 1000,     // 刷新间隔(1分钟)
    }
  },
  
  onLoad: async function(params) {
    // 微信小程序检查登录状态
    // #ifdef MP-WEIXIN
    uni.checkSession({
      success: function(res) {
        if (res.errMsg != 'login:ok') {
          uni.login();
        }
      },
      fail: function(res) {
        console.log(JSON.stringify(res));
        uni.login();
      }
    });
    // #endif
    
    this.initdata();
  },
  
  components: {
    fszmodal,
    QiyanQrcode,
    tkiBarcode,
  },
  
  methods: {
    // 初始化数据
    initdata: function(callback) {
      var _this = this;
      uni.showLoading();
      uni.sm(function(re, err, obj) {
        uni.hideLoading();
        if (err) {
          uni.msg("查询失败");
        } else {
          if (obj && obj.id) {
            _this.currentuid = obj.id;
            _this.name = obj.name;
            _this.unionid = obj.unionid;
            _this.makechar_name = _this.makecharname(_this.name);
            _this.makechar_unionid = _this.unionid.substring(0, 7) + "******" + _this.unionid.substring(13);
            _this.showadd = false;
            _this.getalluiduser(true);
            _this.setqrcode();
            
            // 设置定时刷新
            if (_this.t) {
              clearInterval(_this.t);
            }
            _this.t = setInterval(function() {
              _this.setqrcode();
            }, _this.ttime);
          } else {
            // 没有UID时显示模态框
            _this.showadd = true;
          }
          callback && callback();
        }
      }, ["wx.uiduser.defaultdetail"], {
        route: uni.svs.auth
      });
    },
    
    // 隐藏姓名(只显示第一个字)
    makecharname: function(str) {
      var result = "";
      result += str.substring(0, 1);
      for (var i = 1; i < str.length; i++) {
        result += "*"
      }
      return result;
    },
    
    // 切换姓名显示/隐藏
    viewname: function() {
      this.macknamechar = !this.macknamechar;
    },
    
    // 切换UID号显示/隐藏
    viewunionid: function() {
      this.mackunionidchar = !this.mackunionidchar;
    },
    
    // 手动刷新二维码
    btnsetqrcode: function() {
      var _this = this;
      _this.setqrcode();
      if (_this.t) {
        clearInterval(_this.t);
      }
      _this.t = setInterval(function() {
        _this.setqrcode();
      }, _this.ttime);
    },
    
    // 生成二维码
    setqrcode() {
      var strtime = (new Date()).getTime();
      var strcode = this.unionid + strtime;
      this.title1 = strcode;
      this.nowtime = moment(strtime).format("YYYY年MM月DD日 HH:mm:ss");
      
      // 加密二维码内容
      var cipher = new DigitalCipher("123");
      const encrypted = cipher.enhancedEncrypt(strcode);
      this.title1 = encrypted;
      
      // 更新条形码配置
      this.opations = {
        height: 110,
        width: 3,
        displayValue: false,
        text: this.title1
      };
    },
    
    // 获取所有UID用户
    getalluiduser: function(getcount) {
      var _this = this;
      uni.showLoading();
      uni.sm(function(re, err) {
        uni.hideLoading();
        if (err) {
          uni.msg("查询失败");
        } else {
          if (getcount) {
            _this.uidusercount = re.length;
          } else {
            _this.arruid = [];
            _this.arruid = _this.arruid.concat(re);
          }
        }
      }, ["wx.uiduser.getall"], {
        route: uni.svs.auth
      });
    },
    
    // 打开切换UID弹窗
    btnchangeuid: function() {
      this.showchangeuid = true;
      this.getalluiduser();
    },
    
    // 关闭弹窗
    closePopup() {
      this.showchangeuid = false;
    },
    
    // 设置默认UID
    setuiddefault: function(id) {
      var _this = this;
      uni.showLoading();
      uni.sm(function(re, err) {
        uni.hideLoading();
        if (err) {
          uni.msg("切换失败");
        } else {
          _this.initdata(function() {
            _this.showchangeuid = false;
            uni.msg("切换成功");
            _this.callTabbarMethod();
          });
        }
      }, ["wx.xcxuseruiduser.setdefault", uni.msgwhere({
        uiduserid: [id]
      })], {
        route: uni.svs.auth
      });
    },
    
    // 添加UID
    btnadd: function() {
      uni.navigateTo({
        url: '/pages/manage/uidaddtype'
      });
    },
    
    // 复制到剪贴板
    copyToClipboard(text) {
      // #ifdef MP
      uni.setClipboardData({
        data: text,
        success: function() {
          uni.showToast({
            title: '复制成功',
            icon: 'success',
            duration: 2000
          });
        },
        fail: function(err) {
          uni.showToast({
            title: '复制失败',
            icon: 'none',
            duration: 2000
          });
          console.error('复制失败：', err);
        }
      });
      // #endif
    },
    
    // 刷新数据
    tabbarrefresh: function() {
      this.initdata();
    },
    
    // 调用Tabbar页面方法
    callTabbarMethod() {
      const pages = getCurrentPages();
      for (let i = pages.length - 1; i >= 0; i--) {
        const page = pages[i];
        if (page.route === 'pages/tabBar/home/index') {
          if (page.$vm) {
            page.$vm.tabbarrefresh();
          }
          break;
        }
      }
    }
  }
}
</script>
```

### 样式部分

```css
<style>
page {
  background: #ffffff;
}

.weui-cell__ft {
  color: #8C8C8C;
  font-size: 20rpx;
}

.weui-cell__ft_in-access:after {
  border-color: #8C8C8C;
}

.weui-cell {
  padding: 30rpx 30rpx;
}

.weui-cells:after {
  border-bottom: none;
}

.weui-cell::before {
  right: 30rpx;
  left: 30rpx;
  border-top: none;
}

.weui-cells:before {
  border-top: none;
}

.top-bgview {
  height: 887rpx;
  overflow: hidden;
}

.grayrtxt {
  margin-right: 10px;
  color: #666;
}

.timetxt {
  font-size: 30rpx;
  color: #70CFC2;
  text-align: center;
  line-height: 30px;
}

.barcode {
  width: auto;
  height: 115rpx;
  text-align: center;
  margin: 10px auto;
}

.codeimg {
  width: 460rpx;
  height: 460rpx;
  margin: 10px auto;
}

.refreshcode {
  padding-bottom: 10px;
  line-height: 30px;
  font-size: 24rpx;
  color: #303030;
}

.sel-cell {
  margin: 20rpx 0;
}

.sel-class .classlist {
  background: #F2F4F5;
  border: 1px solid #EEF1F2;
  border-radius: 10rpx;
  font-size: 28rpx;
  color: #303030;
  text-align: left;
  margin: 10px 0;
  padding: 30rpx;
  position: relative;
}

.sel-class {
  margin-bottom: 20px;
}

.sel-class .classlist.current {
  color: #60CABB;
  background: #EFFAF8;
  border-radius: 10rpx;
  border: 1px solid #60CABB;
  text-align: center;
}

.fui-scroll__wrap {
  padding-top: 0 !important;
}

/* 弹窗容器样式 */
.fui-popup__container {
  width: 100%;
  position: relative;
  display: flex;
  justify-content: center;
  flex-direction: column;
  padding: 24rpx 32rpx;
  box-sizing: border-box;
}

.fui-title {
  font-size: 30rpx;
  font-weight: bold;
  text-align: center;
}

.fui-sub__title {
  display: block;
  text-align: center;
  font-size: 24rpx;
  color: #7F7F7F;
  transform: scale(.9);
}

.fui-descr {
  font-weight: bold;
  padding-top: 64rpx;
}

.fui-sub__descr {
  font-size: 26rpx;
  color: #B2B2B2;
  padding: 32rpx 0;
}

.fui-btn__box {
  display: flex;
  justify-content: center;
  padding: 32rpx 0;
  box-sizing: border-box;
  height: 144rpx;
}

.fui-icon__close {
  position: absolute;
  top: 24rpx;
  left: 24rpx;
}

.fui-scroll__wrap {
  padding-top: 30rpx;
  position: relative;
}

.fui-scroll__view {
  width: 100%;
  height: 400rpx;
}

.fui-title__pb {
  padding-bottom: 24rpx;
}
</style>
```

------

## 核心功能说明

### 1. 模态框触发逻辑

当用户未绑定UID时，`showadd` 会被设置为 `true`，模态框自动弹出：

```javascript
if (obj && obj.id) {
  // 有UID数据
  _this.showadd = false;
} else {
  // 没有UID，显示模态框
  _this.showadd = true;
}
```

### 2. 二维码和条形码同时使用

- **二维码组件**：使用 `QiyanQrcode` 组件，传入加密后的内容和尺寸
- **条形码组件**：使用 `tkiBarcode` 组件，配置条形码样式参数
- **自动刷新**：每隔1分钟自动刷新二维码内容，保证安全性

### 3. UID号隐藏/显示

- 点击眼睛图标可以切换UID号的显示状态
- 隐藏时显示：`1234567******890`
- 完整显示时可点击复制图标复制完整UID

### 4. UID切换功能

- 当用户有多个UID时，显示切换按钮
- 点击后弹出底部弹窗，显示所有UID列表
- 选择后切换默认UID，并刷新页面数据

------

## 使用注意事项

1. **组件依赖**：确保已正确引入 `fsz-modal`、`QiyanQrcode`、`tkiBarcode` 组件
2. **路径配置**：图片路径需要根据实际项目调整
3. **加密库**：需要引入 `DigitalCipher.js` 加密工具类
4. **时间库**：需要引入 `moment.min.js` 处理时间格式
5. **定时器清理**：页面销毁时记得清理定时器，防止内存泄漏
6. **权限检查**：在微信小程序中使用时需要检查登录状态

------

## 扩展建议

1. 可以在模态框中添加更多按钮选项
2. 可以自定义模态框的样式和动画效果
3. 可以添加模态框关闭的回调函数
4. 可以优化二维码刷新策略，根据使用场景调整刷新间隔

------

## 总结

`fsz-modal` 模态框组件是一个简单实用的提示组件，配合条件渲染可以实现各种场景下的用户引导。本示例展示了在UID管理场景下的完整应用，包括二维码、条形码的集成使用，以及复杂的数据交互逻辑。
