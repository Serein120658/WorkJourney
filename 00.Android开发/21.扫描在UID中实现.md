## è¾“å…¥æ¡†ç±»å‹æ˜¾ç¤ºæ‰«æåˆ°çš„å†…å®¹

### ä»£ç 

#### scan-manager

```js
/**
 * æ‰«ç æ¨¡å—ç®¡ç†å™¨ - æ··åˆæ¨¡å¼
 * å¹¿æ’­ç›‘å¬æŒ‰é”®çŠ¶æ€ + è¾“å…¥æ¡†æ¥æ”¶æ•°æ®ï¼ˆä½†ä¸ä¼šå¼¹å‡ºé”®ç›˜ï¼‰
 */

const plugin = uni.requireNativePlugin('UniScan');

class ScanManager {
	constructor() {
		this.isInitialized = false;
		this.isScanning = false;
		this.lightsOn = false;
		
		// é…ç½®å‚æ•°
		this.config = {
			vibrate: true,
			sound: true,
			scanInterval: 500,
			broadcastAction: "com.pda.keycode.broacast",
			keyCodeKey: "keycode",
			keyStateKey: "isdown",
			scanKeyCode: 292
		};
		
		// å›è°ƒå‡½æ•°
		this.onScanCallback = null;
		this.onKeyScanCallback = null;
		
		// é˜²æŠ–ç›¸å…³
		this.lastScanData = '';
		this.lastScanTime = 0;
		
		// Androidå¹¿æ’­ç›¸å…³
		this.main = null;
		this.receiver = null;
		this.filter = null;
		
		// è¾“å…¥æ¡†ç›¸å…³ - å…³é”®æ”¹è¿›
		this.scanInputTimer = null;
		this.scanInputValue = '';
		this.inputBuffer = '';  // è¾“å…¥ç¼“å†²åŒº
		this.lastInputTime = 0;
		
		// ä¸ä½¿ç”¨ç„¦ç‚¹ç®¡ç†ï¼Œè®©è¾“å…¥æ¡†ä¸€ç›´å­˜åœ¨ä½†ä¸å¯è§
		this.inputElement = null;
	}

	/**
	 * åˆå§‹åŒ–æ‰«ç æ¨¡å—
	 */
	init(config = {}) {
		if (this.isInitialized) {
			console.warn('æ‰«ç æ¨¡å—å·²åˆå§‹åŒ–,è·³è¿‡é‡å¤åˆå§‹åŒ–');
			return true;
		}

		try {
			// æ£€æŸ¥æ‰«ç åŠŸèƒ½æ˜¯å¦å¯ç”¨
			const result = plugin.isOpenScan();
			
			if (!result) {
				console.error('æ‰«ç åŠŸèƒ½æœªå¼€å¯');
				uni.showToast({
					title: 'æ‰«ç åŠŸèƒ½ä¸å¯ç”¨',
					icon: 'none'
				});
				return false;
			}

			// åˆå¹¶é…ç½®
			this.config = { ...this.config, ...config };
			
			// åº”ç”¨é…ç½®
			plugin.setDecodeTipVibrator(this.config.vibrate);
			plugin.setInputMode(1); // è¿™éƒ¨åˆ†ä¼šä¿®æ”¹é»˜è®¤çš„æ‰«ææ¨¡å¼   å‚å®¶æä¾›çš„sbå¹¿æ’­æ¨¡å¼   ç”¨ä¸äº†  çœŸnt!!
			
			// æ³¨å†ŒæŒ‰é”®ç›‘å¬ï¼ˆåªç”¨äºç›‘å¬æŒ‰é”®çŠ¶æ€ï¼‰
			this.registerKeyListener();
			
			this.isInitialized = true;
			console.log('âœ“ æ‰«ç æ¨¡å—åˆå§‹åŒ–æˆåŠŸ(æ··åˆæ¨¡å¼)', this.config);
			return true;
			
		} catch (e) {
			console.error('âœ— åˆå§‹åŒ–æ‰«ç æ¨¡å—å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * æ³¨å†ŒæŒ‰é”®ç›‘å¬ï¼ˆåªç›‘å¬æŒ‰é”®çŠ¶æ€ï¼‰
	 */
	registerKeyListener() {
		// #ifdef APP-PLUS
		try {
			this.main = plus.android.runtimeMainActivity();
			const IntentFilter = plus.android.importClass('android.content.IntentFilter');
			
			this.filter = new IntentFilter();
			this.filter.addAction(this.config.broadcastAction);
			
			const _this = this;
			this.receiver = plus.android.implements('io.dcloud.feature.internal.reflect.BroadcastReceiver', {
				onReceive: function(context, intent) {
					plus.android.importClass(intent);
					const action = intent.getAction();
					
					if (action === _this.config.broadcastAction) {
						try {
							const keycode = intent.getIntExtra(_this.config.keyCodeKey, 0);
							const isKeyDown = intent.getBooleanExtra(_this.config.keyStateKey, false);
							
							if (keycode === _this.config.scanKeyCode) {
								_this.isScanning = isKeyDown;
								
								if (_this.onKeyScanCallback) {
									_this.onKeyScanCallback(isKeyDown);
								}
								
						
								// æŒ‰é”®é‡Šæ”¾æ—¶ï¼Œå¦‚æœæœ‰ç¼“å†²æ•°æ®ï¼Œç«‹å³å¤„ç†
								if (!isKeyDown && _this.inputBuffer) {
									_this.handleScanData(_this.inputBuffer);
									_this.inputBuffer = '';
								}
							}
						} catch (e) {
							console.log('æ— æŒ‰é”®äº‹ä»¶æ•°æ®');
						}
					}
				}
			});
			
			this.main.registerReceiver(this.receiver, this.filter);
			console.log('âœ“ æŒ‰é”®ç›‘å¬å·²æ³¨å†Œï¼ˆç”¨äºç›‘å¬æ‰«æçŠ¶æ€ï¼‰');
			
		} catch (e) {
			console.error('âœ— æ³¨å†ŒæŒ‰é”®ç›‘å¬å¤±è´¥:', e);
		}
		// #endif
	}

	/**
	 * æ³¨é”€æŒ‰é”®ç›‘å¬
	 */
	unregisterKeyListener() {
		// #ifdef APP-PLUS
		try {
			if (this.main && this.receiver) {
				this.main.unregisterReceiver(this.receiver);
				this.main = null;
				this.receiver = null;
				this.filter = null;
				console.log('âœ“ æŒ‰é”®ç›‘å¬å·²æ³¨é”€');
			}
		} catch (e) {
			console.error('âœ— æ³¨é”€æŒ‰é”®ç›‘å¬å¤±è´¥:', e);
		}
		// #endif
	}

	/**
	 * å¤„ç†æ‰«ç æ•°æ®(å¸¦é˜²æŠ–)
	 */
	handleScanData(scanData) {
		scanData = scanData ? scanData.trim() : '';
		
		if (!scanData) {
			console.log('âŠ— æ‰«ç æ•°æ®ä¸ºç©º');
			return;
		}

		const now = Date.now();
		
		// é˜²æŠ–å¤„ç†
		if (scanData === this.lastScanData && 
			now - this.lastScanTime < this.config.scanInterval) {
			console.log('âŠ— å¿½ç•¥é‡å¤æ‰«æ(é˜²æŠ–)');
			return;
		}
		
		this.lastScanData = scanData;
		this.lastScanTime = now;
		
		// è§¦å‘å›è°ƒ
		if (this.onScanCallback) {
			this.onScanCallback(scanData);
		}
		
		// æç¤ºéŸ³
		if (this.config.sound) {
			uni.showToast({
				title: 'æ‰«ææˆåŠŸ',
				icon: 'success',
				duration: 800
			});
		}
		
		console.log('âœ“ æ‰«ææ•°æ®:', scanData);
	}

	/**
	 * è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶å¤„ç†
	 * æ‰«ç æªè¾“å…¥é€Ÿåº¦å¾ˆå¿«ï¼Œé€šå¸¸åœ¨100mså†…å®Œæˆ
	 */
	onInput(e) {
		const now = Date.now();
		const value = e.detail.value || '';
		
		// å¦‚æœè·ç¦»ä¸Šæ¬¡è¾“å…¥æ—¶é—´å¾ˆçŸ­ï¼ˆæ‰«ç æªç‰¹å¾ï¼‰ï¼Œç´¯ç§¯åˆ°ç¼“å†²åŒº
		if (now - this.lastInputTime < 50) {
			this.inputBuffer = value;
		} else {
			// æ–°çš„è¾“å…¥å¼€å§‹
			this.inputBuffer = value;
		}
		
		this.lastInputTime = now;
		
		// æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
		if (this.scanInputTimer) {
			clearTimeout(this.scanInputTimer);
		}
		
		const _this = this;
		// è¾“å…¥ç»“æŸå150mså¤„ç†æ•°æ®
		this.scanInputTimer = setTimeout(() => {
		
			if (_this.inputBuffer) {
				_this.handleScanData(_this.inputBuffer);
				_this.inputBuffer = '';
				_this.scanInputValue = ''; // æ¸…ç©ºè¾“å…¥æ¡†
			}
		}, 150);
	}

	/**
	 * è¾“å…¥æ¡†ç¡®è®¤äº‹ä»¶å¤„ç†
	 */
	onConfirm(e) {
		const value = e.detail.value.trim();
		if (value) {
			this.handleScanData(value);
			this.scanInputValue = '';
			this.inputBuffer = '';
		}
	}

	/**
	 * å¼€å¯ç¯å…‰
	 */
	turnOnLight() {
		try {
			plugin.setIllPowerLevel(5);
			plugin.setAim(true);
			this.lightsOn = true;
			console.log('âœ“ ç¯å…‰å·²å¼€å¯');
			return true;
		} catch (e) {
			console.error('âœ— å¼€å¯ç¯å…‰å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * å…³é—­ç¯å…‰
	 */
	turnOffLight() {
		try {
			plugin.setIllPowerLevel(0);
			plugin.setAim(false);
			this.lightsOn = false;
			console.log('âœ“ ç¯å…‰å·²å…³é—­');
			return true;
		} catch (e) {
			console.error('âœ— å…³é—­ç¯å…‰å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * åˆ‡æ¢ç¯å…‰
	 */
	toggleLight() {
		if (this.lightsOn) {
			this.turnOffLight();
		} else {
			this.turnOnLight();
		}
		return this.lightsOn;
	}

	/**
	 * è®¾ç½®æ‰«ç æ•°æ®å›è°ƒ
	 */
	setOnScanCallback(callback) {
		this.onScanCallback = callback;
	}

	/**
	 * è®¾ç½®æŒ‰é”®å›è°ƒ
	 */
	setOnKeyScanCallback(callback) {
		this.onKeyScanCallback = callback;
	}

	/**
	 * æ›´æ–°é…ç½®
	 */
	updateConfig(config) {
		this.config = { ...this.config, ...config };
		
		if (this.isInitialized && config.vibrate !== undefined) {
			plugin.setDecodeTipVibrator(this.config.vibrate);
		}
	}

	/**
	 * è·å–å½“å‰é…ç½®
	 */
	getCurrentConfig() {
		return { ...this.config };
	}

	/**
	 * æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
	 */
	isReady() {
		return this.isInitialized;
	}

	/**
	 * æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ‰«æ
	 */
	isScanningNow() {
		return this.isScanning;
	}

	/**
	 * æ£€æŸ¥ç¯å…‰çŠ¶æ€
	 */
	isLightOn() {
		return this.lightsOn;
	}

	/**
	 * ååˆå§‹åŒ–
	 */
	uninit() {
		if (!this.isInitialized) return;

		// æ³¨é”€ç›‘å¬
		this.unregisterKeyListener();
		
		// æ¸…é™¤å®šæ—¶å™¨
		if (this.scanInputTimer) {
			clearTimeout(this.scanInputTimer);
			this.scanInputTimer = null;
		}
		
		// å…³é—­ç¯å…‰
		if (this.lightsOn) {
			this.turnOffLight();
		}
		
		// é‡ç½®çŠ¶æ€
		this.isInitialized = false;
		this.isScanning = false;
		this.scanInputValue = '';
		this.inputBuffer = '';
		this.lastInputTime = 0;
		
		console.log('âœ“ æ‰«ç æ¨¡å—å·²ååˆå§‹åŒ–');
	}
}

// å¯¼å‡ºå•ä¾‹
export default new ScanManager();
```

#### retrieval/index.vue

```vue
<template>
	<view class="page">
		<!-- é¡¶éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
		<view class="stats-bar">
			<view class="stat-item">
				<text class="stat-value">{{ totalScans }}</text>
				<text class="stat-label">æ‰«ææ€»æ•°</text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value">{{ uniqueScans }}</text>
				<text class="stat-label">ä¸åŒç¼–ç </text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value" :class="scanManager.isLightOn() ? 'text-success' : 'text-muted'">
					{{ scanManager.isLightOn() ? 'å·²å¼€å¯' : 'å·²å…³é—­' }}
				</text>
				<text class="stat-label">ç¯å…‰çŠ¶æ€</text>
			</view>
		</view>

		<!-- ä¸»å†…å®¹åŒº -->
		<view class="main-content">
			<!-- æ‰«ææ˜¾ç¤ºåŒºåŸŸ -->
			<view class="scan-display-card">
				<view class="display-header">
					<view class="header-left">
						<text class="input-icon">ğŸ“±</text>
						<text class="input-title">æ‰«æåŒºåŸŸ</text>
					</view>
					<view class="header-right">
						<!-- ç¯å…‰å¼€å…³ -->
						<view class="light-switch" @click="toggleLights">
							<text class="light-icon">{{ scanManager.isLightOn() ? 'ğŸ’¡' : 'ğŸ”¦' }}</text>
							<text class="light-text">{{ scanManager.isLightOn() ? 'å…³ç¯' : 'å¼€ç¯' }}</text>
						</view>
						<!-- æ¸…ç©ºæŒ‰é’® -->
						<view class="clear-btn" @click="clearData">
							<text class="clear-icon">ğŸ—‘ï¸</text>
							<text class="clear-text">æ¸…ç©º</text>
						</view>
					</view>
				</view>
				
				<!-- å½“å‰æ‰«æç»“æœ -->
				<view class="current-result" v-if="currentScanData">
					<view class="result-content">
						<text class="result-data">{{ currentScanData }}</text>
					</view>
					<view class="result-footer">
						<text class="result-time">{{ currentScanTime }}</text>
					</view>
				</view>
				
				<!-- ç­‰å¾…æ‰«æçŠ¶æ€ -->
				<view class="waiting-state" v-else>
					<text class="waiting-icon">ğŸ“·</text>
					<text class="waiting-text">ç­‰å¾…æ‰«æ...</text>
					<text class="waiting-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
				</view>
			</view>
			
			<!-- æ‰«æå†å² -->
			<view class="history-section" v-if="scanHistory.length > 0">
				<view class="section-header">
					<text class="section-title">æ‰«æå†å²</text>
					<text class="section-count">å…± {{ uniqueScans }} ç§ç¼–ç </text>
				</view>
				
				<scroll-view class="history-scroll" scroll-y="true">
					<view 
						class="history-card" 
						v-for="(item, index) in scanHistory" 
						:key="index"
					>
						<view class="history-number">{{ index + 1 }}</view>
						<view class="history-info">
							<text class="history-data">{{ item.data }}</text>
							<text class="history-time">é¦–æ¬¡: {{ item.firstTime }}</text>
							<text class="history-time" v-if="item.count > 1">æœ€è¿‘: {{ item.lastTime }}</text>
						</view>
						<view class="history-count" v-if="item.count > 1">
							<text class="count-text">Ã—{{ item.count }}</text>
						</view>
					</view>
				</scroll-view>
			</view>
			
			<!-- ç©ºçŠ¶æ€ -->
			<view class="empty-state" v-if="!currentScanData && scanHistory.length === 0">
				<text class="empty-icon">ğŸ“¦</text>
				<text class="empty-text">æš‚æ— æ‰«æè®°å½•</text>
				<text class="empty-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
			</view>
		</view>

		<!-- éšè—çš„è¾“å…¥æ¡†ç”¨äºæ¥æ”¶æ‰«ç æ•°æ® -->
		<input 
			v-model="scanManager.scanInputValue"
			@input="handleScanInput"
			@confirm="handleScanConfirm"
			@focus="handleInputFocus"
			@blur="handleInputBlur"
			type="text"
			class="scan-input"
			:focus="inputFocused"
			:adjust-position="false"
			:cursor-spacing="0"
			confirm-type="done"
		/>
	</view>
</template>

<script>
import ScanManager from '@/common/scan-manager'

export default {
	name: 'ScanPage',
	
	data() {
		return {
			scanManager: ScanManager,
			
			// æ‰«ææ•°æ®
			currentScanData: '',
			currentScanTime: '',
			scanHistory: [],
			
			// è¾“å…¥æ¡†ç„¦ç‚¹çŠ¶æ€
			inputFocused: false
		}
	},
	
	computed: {
		totalScans() {
			return this.scanHistory.reduce((sum, item) => sum + item.count, 0);
		},
		uniqueScans() {
			return this.scanHistory.length;
		}
	},
	
	onShow() {
		console.log('é¡µé¢æ˜¾ç¤º - åˆå§‹åŒ–æ‰«ç æ¨¡å—(æ··åˆæ¨¡å¼)');
		
		// åˆå§‹åŒ–é…ç½®
		const config = {
			vibrate: true,
			sound: true,
			scanInterval: 500,
			broadcastAction: "com.pda.keycode.broacast",
			keyCodeKey: "keycode",
			keyStateKey: "isdown",
			scanKeyCode: 292
		};
		
		ScanManager.init(config);
		
		// è®¾ç½®å›è°ƒ
		ScanManager.setOnScanCallback(this.onScanData);
		ScanManager.setOnKeyScanCallback(this.onKeyScan);
		
		// é»˜è®¤å¼€å¯ç¯å…‰
		ScanManager.turnOnLight();
		
		// å…³é”®ï¼šå»¶è¿Ÿèšç„¦è¾“å…¥æ¡†å¹¶éšè—é”®ç›˜
		this.$nextTick(() => {
			setTimeout(() => {
				this.inputFocused = true;
				
				// ç«‹å³éšè—é”®ç›˜
				setTimeout(() => {
					this.hideKeyboard();
			
				}, 100);
			}, 300);
		});
	},
	
	onHide() {
		console.log('é¡µé¢éšè— - æ¸…ç†èµ„æº');
		ScanManager.uninit();
	},
	
	onUnload() {
		console.log('é¡µé¢å¸è½½ - å®Œå…¨æ¸…ç†');
		ScanManager.uninit();
	},
	
	methods: {
		/**
		 * æ‰«ç æ•°æ®å›è°ƒ
		 */
		onScanData(data) {
			this.currentScanData = data;
			this.currentScanTime = this.formatDateTime(new Date());
			
			// æŸ¥æ‰¾å†å²è®°å½•
			const existingIndex = this.scanHistory.findIndex(item => item.data === data);
			
			if (existingIndex !== -1) {
				// æ›´æ–°å·²å­˜åœ¨çš„è®°å½•
				this.scanHistory[existingIndex].count++;
				this.scanHistory[existingIndex].lastTime = this.formatDateTime(new Date());
				
				// ç§»åˆ°æœ€å‰é¢
				const item = this.scanHistory.splice(existingIndex, 1)[0];
				this.scanHistory.unshift(item);
			} else {
				// æ·»åŠ æ–°è®°å½•
				this.scanHistory.unshift({
					data: data,
					firstTime: this.formatDateTime(new Date()),
					lastTime: this.formatDateTime(new Date()),
					count: 1
				});
			}
		},
		
		/**
		 * æŒ‰é”®çŠ¶æ€å›è°ƒ
		 */
		onKeyScan(isKeyDown) {
			if (isKeyDown) {
				console.log('æ‰«æé”®æŒ‰ä¸‹');
			} else {
				console.log('æ‰«æé”®é‡Šæ”¾');
			}
		},
		
		/**
		 * è¾“å…¥æ¡†è¾“å…¥å¤„ç†
		 */
		handleScanInput(e) {
			
			ScanManager.onInput(e);
		},
		
		/**
		 * è¾“å…¥æ¡†ç¡®è®¤å¤„ç†
		 */
		handleScanConfirm(e) {
			
			ScanManager.onConfirm(e);
		},
		
		/**
		 * è¾“å…¥æ¡†èšç„¦å¤„ç†
		 */
		handleInputFocus() {
			
			// ç«‹å³éšè—é”®ç›˜
			setTimeout(() => {
				this.hideKeyboard();
			}, 50);
		},
		
		/**
		 * è¾“å…¥æ¡†å¤±ç„¦å¤„ç†
		 */
		handleInputBlur() {
			
			// é‡æ–°èšç„¦
			setTimeout(() => {
				this.inputFocused = false;
				this.$nextTick(() => {
					this.inputFocused = true;
					setTimeout(() => {
						this.hideKeyboard();
					}, 50);
				});
			}, 100);
		},
		
		/**
		 * éšè—é”®ç›˜
		 */
		hideKeyboard() {
			// #ifdef APP-PLUS
			try {
				plus.key.hideSoftKeybord();
			} catch (e) {
				console.log('éšè—é”®ç›˜:', e);
			}
			// #endif
		},
		
		/**
		 * åˆ‡æ¢ç¯å…‰
		 */
		toggleLights() {
			const isOn = ScanManager.toggleLight();
			
			uni.showToast({
				title: isOn ? 'ç¯å…‰å·²å¼€å¯' : 'ç¯å…‰å·²å…³é—­',
				icon: 'none',
				duration: 1000
			});
			
			// ç¡®ä¿è¾“å…¥æ¡†ä¿æŒèšç„¦ä¸”é”®ç›˜éšè—
			this.$nextTick(() => {
				this.inputFocused = false;
				this.$nextTick(() => {
					this.inputFocused = true;
					setTimeout(() => {
						this.hideKeyboard();
					}, 50);
				});
			});
		},
		
		/**
		 * æ¸…ç©ºæ•°æ®
		 */
		clearData() {
			if (this.scanHistory.length === 0 && !this.currentScanData) {
				uni.showToast({
					title: 'æš‚æ— æ•°æ®',
					icon: 'none'
				});
				return;
			}
			
			uni.showModal({
				title: 'ç¡®è®¤æ¸…ç©º',
				content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰«æè®°å½•å—?',
				success: (res) => {
					if (res.confirm) {
						this.currentScanData = '';
						this.currentScanTime = '';
						this.scanHistory = [];
						
						uni.showToast({
							title: 'å·²æ¸…ç©º',
							icon: 'success'
						});
						
						// ç¡®ä¿è¾“å…¥æ¡†ä¿æŒèšç„¦ä¸”é”®ç›˜éšè—
						this.$nextTick(() => {
							this.inputFocused = false;
							this.$nextTick(() => {
								this.inputFocused = true;
								setTimeout(() => {
									this.hideKeyboard();
								}, 50);
							});
						});
					}
				}
			});
		},
		
		/**
		 * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
		 */
		formatDateTime(date) {
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');
			const seconds = String(date.getSeconds()).padStart(2, '0');
			
			return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
		}
	}
}
</script>

<style lang="scss" scoped>
	.page {
		display: flex;
		flex-direction: column;
		height: 100vh;
		background: #f5f7fa;
	}
	
	.scan-input {
		position: fixed;
		left: -9999rpx;
		top: -9999rpx;
		width: 1rpx;
		height: 1rpx;
		opacity: 0;
		z-index: -1;
		pointer-events: none;
		user-select: none;
		-webkit-user-select: none;
	}
	
	.stats-bar {
		display: flex;
		background: white;
		padding: 30rpx;
		box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.06);
	}
	
	.stat-item {
		flex: 1;
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	
	.stat-value {
		font-size: 40rpx;
		font-weight: bold;
		color: #409eff;
		margin-bottom: 8rpx;
	}
	
	.stat-label {
		font-size: 24rpx;
		color: #999;
	}
	
	.stat-divider {
		width: 2rpx;
		height: 60rpx;
		background: #e8e8e8;
		margin: 0 20rpx;
	}
	
	.text-success {
		color: #67c23a !important;
	}
	
	.text-muted {
		color: #909399 !important;
	}
	
	.main-content {
		flex: 1;
		overflow-y: auto;
		padding: 20rpx;
	}
	
	.scan-display-card {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		margin-bottom: 20rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.display-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
	}
	
	.header-left {
		display: flex;
		align-items: center;
	}
	
	.input-icon {
		font-size: 36rpx;
		margin-right: 12rpx;
	}
	
	.input-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.header-right {
		display: flex;
		gap: 16rpx;
	}
	
	.light-switch {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #f5f7fa;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.light-switch:active {
		background: #e4e7ed;
		transform: scale(0.95);
	}
	
	.light-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.light-text {
		font-size: 22rpx;
		color: #666;
	}
	
	.clear-btn {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #fff5f5;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.clear-btn:active {
		background: #fee;
		transform: scale(0.95);
	}
	
	.clear-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.clear-text {
		font-size: 22rpx;
		color: #f56c6c;
	}
	
	.current-result {
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		border-radius: 12rpx;
		padding: 24rpx;
	}
	
	.result-content {
		background: rgba(255, 255, 255, 0.15);
		padding: 24rpx;
		border-radius: 8rpx;
		margin-bottom: 16rpx;
	}
	
	.result-data {
		font-size: 32rpx;
		color: white;
		word-break: break-all;
		line-height: 1.6;
		font-weight: 500;
	}
	
	.result-footer {
		text-align: right;
	}
	
	.result-time {
		font-size: 24rpx;
		color: rgba(255, 255, 255, 0.7);
	}
	
	.waiting-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 60rpx 40rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		border: 2rpx dashed #dcdfe6;
	}
	
	.waiting-icon {
		font-size: 80rpx;
		margin-bottom: 20rpx;
		opacity: 0.5;
	}
	
	.waiting-text {
		font-size: 28rpx;
		color: #909399;
		margin-bottom: 12rpx;
		font-weight: 500;
	}
	
	.waiting-hint {
		font-size: 24rpx;
		color: #c0c4cc;
		text-align: center;
		line-height: 1.6;
	}
	
	.history-section {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
		padding-bottom: 20rpx;
		border-bottom: 2rpx solid #f0f0f0;
	}
	
	.section-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.section-count {
		font-size: 24rpx;
		color: #999;
	}
	
	.history-scroll {
		max-height: 600rpx;
	}
	
	.history-card {
		display: flex;
		align-items: center;
		padding: 24rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		margin-bottom: 16rpx;
		transition: all 0.2s;
	}
	
	.history-card:active {
		background: #e9ecef;
		transform: scale(0.98);
	}
	
	.history-number {
		width: 56rpx;
		height: 56rpx;
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		color: white;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24rpx;
		font-weight: bold;
		flex-shrink: 0;
		margin-right: 20rpx;
	}
	
	.history-info {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: center;
		min-width: 0;
	}
	
	.history-data {
		font-size: 28rpx;
		color: #333;
		word-break: break-all;
		margin-bottom: 8rpx;
		line-height: 1.5;
		font-weight: 500;
	}
	
	.history-time {
		font-size: 22rpx;
		color: #999;
		line-height: 1.4;
	}
	
	.history-count {
		flex-shrink: 0;
		margin-left: 16rpx;
		padding: 8rpx 16rpx;
		background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
		border-radius: 20rpx;
	}
	
	.count-text {
		font-size: 24rpx;
		color: white;
		font-weight: bold;
	}
	
	.empty-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 120rpx 40rpx;
		background: white;
		border-radius: 16rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.empty-icon {
		font-size: 120rpx;
		margin-bottom: 30rpx;
		opacity: 0.5;
	}
	
	.empty-text {
		font-size: 32rpx;
		color: #666;
		margin-bottom: 16rpx;
		font-weight: 500;
	}
	
	.empty-hint {
		font-size: 26rpx;
		color: #999;
		text-align: center;
		line-height: 1.6;
	}
</style>
```



### æ•ˆæœ

![image-20251107105241633](21.æ‰«æåœ¨UIDä¸­å®ç°.assets/image-20251107105241633.png)

### å­˜åœ¨çš„BUG

1. å¼€å…³ç¯å½±å“èšç„¦  å¯¼è‡´ç‚¹å‡»åæ‰«æä¸åˆ°
2. æ¸…ç©ºåå†æ¬¡æ‰«ï¼Œæ‰«æåˆ°ï¼ï¼ï¼



## ä½¿ç”¨å¹¿æ’­æ¨¡å¼æ˜¾ç¤ºæ‰«æåˆ°çš„å†…å®¹

è¿™ä¸ªå¹¿æ’­ä¸å¤ªå¥½ç†è§£  ä¸çŸ¥é“è®¾å¤‡æ”¯æŒé‚£äº›å¹¿æ’­ï¼ï¼ï¼ï¼

ä¹Ÿå°±æ˜¯å‘é€å¹¿æ’­  æ”¶åˆ°åæ˜¾ç¤º  

1. åŒé‡æ¥æ”¶æ–¹å¼ï¼š

   - ğŸ“¡ **å¹¿æ’­æ¥æ”¶**ï¼šç›‘å¬å¤šç§å¯èƒ½çš„å¹¿æ’­actionå’Œæ•°æ®key
   - ğŸ“ **è¾“å…¥æ¡†åå¤‡**ï¼šå¦‚æœå¹¿æ’­ä¸å·¥ä½œï¼Œè¾“å…¥æ¡†ä»å¯æ¥æ”¶æ•°æ®

2. è°ƒè¯•æŒ‰é’®ï¼ˆå³ä¸‹è§’è“è‰²åœ†å½¢æŒ‰é’® ğŸ”ï¼‰

   ï¼š ç‚¹å‡»å¯æŸ¥çœ‹ï¼š

   - å½“å‰ä½¿ç”¨çš„æ‰«ææ–¹å¼ï¼ˆå¹¿æ’­ or è¾“å…¥æ¡†ï¼‰
   - æ¥æ”¶åˆ°çš„æ‰€æœ‰å¹¿æ’­action
   - æ‰«æç»Ÿè®¡ä¿¡æ¯

3. ç›‘å¬çš„å¹¿æ’­actionsï¼š

   - `android.intent.ACTION_DECODE_DATA`
   - `com.scanner.broadcast`
   - `scan.rcv.message`
   - `nlscan.action.SCANNER_RESULT`
   - `com.android.server.scannerservice.broadcast`
   - `com.pda.keycode.broacast`

4. å°è¯•çš„æ•°æ®keysï¼š

   - `barcode`
   - `data`
   - `scannerdata`
   - `value`
   - `scan_data`
   - `SCAN_BARCODE1`
   - `SCAN_BARCODE2`

1. **è¿è¡Œä»£ç åï¼Œæ‰«æä¸€ä¸ªæ¡ç **

2. **ç‚¹å‡»å³ä¸‹è§’è°ƒè¯•æŒ‰é’® ğŸ”**

3. æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯

   ï¼Œä¼šæ˜¾ç¤ºï¼š

   - å¦‚æœæ˜¾ç¤º `æ‰«ææ–¹å¼: input` â†’ è¯´æ˜æ˜¯é€šè¿‡è¾“å…¥æ¡†æ¥æ”¶çš„
   - å¦‚æœæ˜¾ç¤º `æ‰«ææ–¹å¼: broadcast:xxx:yyy` â†’ è¯´æ˜é€šè¿‡å¹¿æ’­æ¥æ”¶æˆåŠŸ
   - æ¥æ”¶åˆ°çš„å¹¿æ’­åˆ—è¡¨ â†’ å¯ä»¥çœ‹åˆ°ä½ çš„è®¾å¤‡å‘é€äº†å“ªäº›å¹¿æ’­

å½“å‰è®¾å¤‡ä¸æ”¯æŒ   åŒå¹¿æ’­ï¼ï¼

### è°ƒè¯•ä»£ç 

```vue
<template>
	<view class="page">
		<!-- é¡¶éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
		<view class="stats-bar">
			<view class="stat-item">
				<text class="stat-value">{{ totalScans }}</text>
				<text class="stat-label">æ‰«ææ€»æ•°</text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value">{{ uniqueScans }}</text>
				<text class="stat-label">ä¸åŒç¼–ç </text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value" :class="lightsOn ? 'text-success' : 'text-muted'">
					{{ lightsOn ? 'å·²å¼€å¯' : 'å·²å…³é—­' }}
				</text>
				<text class="stat-label">ç¯å…‰çŠ¶æ€</text>
			</view>
		</view>

		<!-- ä¸»å†…å®¹åŒº -->
		<view class="main-content">
			<!-- æ‰«ææ˜¾ç¤ºåŒºåŸŸ -->
			<view class="scan-display-card">
				<view class="display-header">
					<view class="header-left">
						<text class="input-icon">ğŸ“±</text>
						<text class="input-title">æ‰«æåŒºåŸŸ</text>
					</view>
					<view class="header-right">
						<!-- ç¯å…‰å¼€å…³ -->
						<view class="light-switch" @click="toggleLights">
							<text class="light-icon">{{ lightsOn ? 'ğŸ’¡' : 'ğŸ”¦' }}</text>
							<text class="light-text">{{ lightsOn ? 'å…³ç¯' : 'å¼€ç¯' }}</text>
						</view>
						<!-- æ¸…ç©ºæŒ‰é’® -->
						<view class="clear-btn" @click="clearData">
							<text class="clear-icon">ğŸ—‘ï¸</text>
							<text class="clear-text">æ¸…ç©º</text>
						</view>
					</view>
				</view>
				
				<!-- å½“å‰æ‰«æç»“æœ -->
				<view class="current-result" v-if="currentScanData">
					<view class="result-content">
						<text class="result-data">{{ currentScanData }}</text>
					</view>
					<view class="result-footer">
						<text class="result-time">{{ currentScanTime }}</text>
					</view>
				</view>
				
				<!-- ç­‰å¾…æ‰«æçŠ¶æ€ -->
				<view class="waiting-state" v-else>
					<text class="waiting-icon">ğŸ“·</text>
					<text class="waiting-text">ç­‰å¾…æ‰«æ...</text>
					<text class="waiting-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
				</view>
			</view>
			
			<!-- æ‰«æå†å² -->
			<view class="history-section" v-if="scanHistory.length > 0">
				<view class="section-header">
					<text class="section-title">æ‰«æå†å²</text>
					<text class="section-count">å…± {{ uniqueScans }} ç§ç¼–ç </text>
				</view>
				
				<scroll-view class="history-scroll" scroll-y="true">
					<view 
						class="history-card" 
						v-for="(item, index) in scanHistory" 
						:key="index"
					>
						<view class="history-number">{{ index + 1 }}</view>
						<view class="history-info">
							<text class="history-data">{{ item.data }}</text>
							<text class="history-time">é¦–æ¬¡: {{ item.firstTime }}</text>
							<text class="history-time" v-if="item.count > 1">æœ€è¿‘: {{ item.lastTime }}</text>
						</view>
						<view class="history-count" v-if="item.count > 1">
							<text class="count-text">Ã—{{ item.count }}</text>
						</view>
					</view>
				</scroll-view>
			</view>
			
			<!-- ç©ºçŠ¶æ€ -->
			<view class="empty-state" v-if="!currentScanData && scanHistory.length === 0">
				<text class="empty-icon">ğŸ“¦</text>
				<text class="empty-text">æš‚æ— æ‰«æè®°å½•</text>
				<text class="empty-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
			</view>
		</view>

		<!-- éšè—çš„è¾“å…¥æ¡†ç”¨äºæ¥æ”¶æ‰«ææ•°æ® - ä½œä¸ºåå¤‡æ–¹æ¡ˆ -->
		<input 
			v-model="scanInputValue"
			@input="onScanInput"
			@confirm="onScanConfirm"
			type="text"
			class="hidden-input"
			:focus="inputFocused"
			:adjust-position="false"
			:show-confirm-bar="false"
		/>
		
		<!-- è°ƒè¯•æŒ‰é’® -->
		<view class="debug-btn" @click="showDebugInfo">
			<text>ğŸ”</text>
		</view>
	</view>
</template>

<script>
// å¼•å…¥æ‰«ææ’ä»¶
const plugin = uni.requireNativePlugin('UniScan');

export default {
	name: 'ScanPage',
	
	data() {
		return {
			// æ‰«æç›¸å…³
			currentScanData: '',      // å½“å‰æ‰«æçš„æ•°æ®
			currentScanTime: '',      // å½“å‰æ‰«ææ—¶é—´
			scanHistory: [],          // æ‰«æå†å²è®°å½•ï¼ˆåˆå¹¶ç›¸åŒç¼–ç ï¼‰
			scanInputValue: '',       // è¾“å…¥æ¡†çš„å€¼ï¼ˆåå¤‡æ–¹æ¡ˆï¼‰
			inputFocused: false,      // è¾“å…¥æ¡†æ˜¯å¦èšç„¦
			
			// ç¯å…‰æ§åˆ¶
			lightsOn: true,           // ç¯å…‰æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤å¼€å¯ï¼‰
			
			// è®¾ç½®
			settings: {
				vibrate: true,        // éœ‡åŠ¨åé¦ˆ
				sound: true,          // æç¤ºéŸ³
				scanInterval: 1000,   // é˜²æŠ–é—´éš”(æ¯«ç§’)
			},
			
			// é˜²æŠ–ç›¸å…³
			lastScanData: '',         // ä¸Šæ¬¡æ‰«æçš„æ•°æ®
			lastScanTime: 0,          // ä¸Šæ¬¡æ‰«æçš„æ—¶é—´æˆ³
			
			// Androidå¹¿æ’­ç›¸å…³
			main: null,
			receiver: null,
			filter: null,
			
			// æ‰«æè¾“å…¥ç›‘å¬
			scanInputTimer: null,
			
			// é¡µé¢çŠ¶æ€
			isPageActive: false,
			
			// è°ƒè¯•ä¿¡æ¯
			debugInfo: {
				broadcastReceived: [],  // æ¥æ”¶åˆ°çš„å¹¿æ’­
				scanMethod: 'unknown'   // ä½¿ç”¨çš„æ‰«ææ–¹å¼
			}
		}
	},
	
	computed: {
		// è®¡ç®—æ€»æ‰«ææ¬¡æ•°
		totalScans() {
			return this.scanHistory.reduce(function(sum, item) {
				return sum + item.count;
			}, 0);
		},
		// è®¡ç®—ä¸åŒç¼–ç æ•°é‡
		uniqueScans() {
			return this.scanHistory.length;
		}
	},
	
	// é¡µé¢æ˜¾ç¤ºæ—¶è§¦å‘
	onShow() {
		console.log('é¡µé¢æ˜¾ç¤º - åˆå§‹åŒ–æ‰«ææ’ä»¶');
		this.isPageActive = true;
		this.initScanPlugin();
		this.registerBroadcastReceiver();
		this.loadSettings();
		
		// é»˜è®¤å¼€å¯ç¯å…‰
		this.turnOnLight();
		
		// å¯ç”¨è¾“å…¥æ¡†ä½œä¸ºåå¤‡æ–¹æ¡ˆ
		this.$nextTick(function() {
			var _this = this;
			setTimeout(function() {
				_this.inputFocused = true;
				console.log('è¾“å…¥æ¡†å·²å¯ç”¨ï¼ˆåå¤‡æ–¹æ¡ˆï¼‰');
			}, 300);
		});
	},
	
	// é¡µé¢éšè—æ—¶è§¦å‘(åˆ‡æ¢åˆ°å…¶ä»–tab)
	onHide() {
		console.log('é¡µé¢éšè— - æ¸…ç†èµ„æº');
		this.isPageActive = false;
		this.cleanupResources();
	},
	
	// é¡µé¢å¸è½½æ—¶è§¦å‘
	onUnload() {
		console.log('é¡µé¢å¸è½½ - å®Œå…¨æ¸…ç†');
		this.isPageActive = false;
		this.cleanupResources();
	},
	
	methods: {
		/**
		 * åˆå§‹åŒ–æ‰«ææ’ä»¶
		 */
		initScanPlugin() {
			try {
				var result = plugin.isOpenScan();
				
				if (result) {
					plugin.setDecodeTipVibrator(this.settings.vibrate);
					console.log('âœ“ æ‰«ææ’ä»¶åˆå§‹åŒ–æˆåŠŸ');
				} else {
					console.error('âœ— æ‰«æåŠŸèƒ½æœªå¼€å¯');
					uni.showToast({
						title: 'æ‰«æåŠŸèƒ½ä¸å¯ç”¨',
						icon: 'none'
					});
				}
			} catch (e) {
				console.error('åˆå§‹åŒ–æ‰«ææ’ä»¶å¤±è´¥:', e);
			}
		},
		
		/**
		 * æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ - ç›‘å¬æ‰€æœ‰å¯èƒ½çš„æ‰«æå¹¿æ’­
		 */
		registerBroadcastReceiver() {
			// #ifdef APP-PLUS
			try {
				var _this = this;
				
				this.main = plus.android.runtimeMainActivity();
				var IntentFilter = plus.android.importClass('android.content.IntentFilter');
				
				this.filter = new IntentFilter();
				
				// æ·»åŠ å¤šä¸ªå¯èƒ½çš„å¹¿æ’­action
				var possibleActions = [
					"android.intent.ACTION_DECODE_DATA",  // é€šç”¨æ‰«ææ•°æ®
					"com.scanner.broadcast",               // å¸¸è§æ‰«æå¹¿æ’­
					"scan.rcv.message",                    // æŸäº›è®¾å¤‡ä½¿ç”¨
					"nlscan.action.SCANNER_RESULT",       // æ–°å¤§é™†æ‰«ææª
					"com.android.server.scannerservice.broadcast", // æŸäº›PDA
					"com.pda.keycode.broacast"            // æŒ‰é”®å¹¿æ’­
				];
				
				for (var i = 0; i < possibleActions.length; i++) {
					this.filter.addAction(possibleActions[i]);
				}
				
				this.receiver = plus.android.implements('io.dcloud.feature.internal.reflect.BroadcastReceiver', {
					onReceive: function(context, intent) {
						plus.android.importClass(intent);
						
						var action = intent.getAction();
						console.log('ğŸ“¡ æ¥æ”¶åˆ°å¹¿æ’­:', action);
						
						// è®°å½•æ¥æ”¶åˆ°çš„å¹¿æ’­
						_this.debugInfo.broadcastReceived.push({
							action: action,
							time: new Date().toLocaleTimeString()
						});
						
						// å°è¯•ä»ä¸åŒçš„keyè·å–æ‰«ææ•°æ®
						var scanData = null;
						var possibleKeys = [
							"barcode",           // æœ€å¸¸è§
							"data",              // é€šç”¨
							"scannerdata",       // æŸäº›è®¾å¤‡
							"value",             // æŸäº›è®¾å¤‡
							"scan_data",         // ä¸‹åˆ’çº¿æ ¼å¼
							"SCAN_BARCODE1",     // å¤§å†™æ ¼å¼
							"SCAN_BARCODE2"      
						];
						
						for (var j = 0; j < possibleKeys.length; j++) {
							try {
								var tempData = intent.getStringExtra(possibleKeys[j]);
								if (tempData && tempData.length > 0) {
									scanData = tempData;
									console.log('âœ“ ä»key "' + possibleKeys[j] + '" è·å–åˆ°æ•°æ®:', scanData);
									_this.debugInfo.scanMethod = 'broadcast:' + action + ':' + possibleKeys[j];
									break;
								}
							} catch (e) {
								// å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªkey
							}
						}
						
						// å¤„ç†æŒ‰é”®å¹¿æ’­
						if (action === "com.pda.keycode.broacast") {
							var keycode = intent.getIntExtra("keycode", 0);
							var isKeyDown = intent.getBooleanExtra("isdown", false);
							console.log('æŒ‰é”®ç :', keycode, 'æŒ‰ä¸‹:', isKeyDown);
						}
						
						// å¦‚æœè·å–åˆ°æ‰«ææ•°æ®ï¼Œåˆ™å¤„ç†
						if (scanData && _this.isPageActive) {
							console.log('âœ“ é€šè¿‡å¹¿æ’­æ¥æ”¶åˆ°æ‰«ææ•°æ®:', scanData);
							_this.handleScanData(scanData);
						}
					}
				});
				
				this.main.registerReceiver(this.receiver, this.filter);
				console.log('âœ“ å¹¿æ’­æ¥æ”¶å™¨å·²æ³¨å†Œï¼Œç›‘å¬å¤šä¸ªaction');
				
			} catch (e) {
				console.error('âœ— æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨å¤±è´¥:', e);
			}
			// #endif
		},
		
		/**
		 * æ³¨é”€å¹¿æ’­æ¥æ”¶å™¨
		 */
		unregisterBroadcastReceiver() {
			// #ifdef APP-PLUS
			try {
				if (this.main && this.receiver) {
					this.main.unregisterReceiver(this.receiver);
					this.main = null;
					this.receiver = null;
					this.filter = null;
					console.log('âœ“ å¹¿æ’­æ¥æ”¶å™¨å·²æ³¨é”€');
				}
			} catch (e) {
				console.error('âœ— æ³¨é”€å¹¿æ’­æ¥æ”¶å™¨å¼‚å¸¸:', e);
			}
			// #endif
		},
		
		/**
		 * æ¸…ç†èµ„æº
		 */
		cleanupResources() {
			this.unregisterBroadcastReceiver();
			
			if (this.scanInputTimer) {
				clearTimeout(this.scanInputTimer);
				this.scanInputTimer = null;
			}
			
			if (this.lightsOn) {
				try {
					plugin.setIllPowerLevel(0);
					plugin.setAim(false);
					this.lightsOn = false;
				} catch (e) {
					console.error('å…³é—­ç¯å…‰å¤±è´¥:', e);
				}
			}
			
			this.inputFocused = false;
			this.saveSettings();
		},
		
		/**
		 * å¤„ç†æ‰«ææ•°æ®(å¸¦é˜²æŠ–å’Œåˆå¹¶)
		 */
		handleScanData(scanData) {
			console.log('handleScanData è¢«è°ƒç”¨, æ•°æ®:', scanData);
			
			if (!this.isPageActive) {
				console.log('é¡µé¢æœªæ¿€æ´»,å¿½ç•¥æ‰«æ');
				return;
			}
			
			scanData = scanData.trim();
			
			if (!scanData) {
				console.log('æ‰«ææ•°æ®ä¸ºç©º,å¿½ç•¥');
				return;
			}
			
			var now = Date.now();
			
			if (scanData === this.lastScanData && 
				now - this.lastScanTime < this.settings.scanInterval) {
				console.log('å¿½ç•¥é‡å¤æ‰«æ(é˜²æŠ–)');
				return;
			}
			
			this.lastScanData = scanData;
			this.lastScanTime = now;
			
			this.currentScanData = scanData;
			this.currentScanTime = this.formatDateTime(new Date());
			
			console.log('æ›´æ–°å½“å‰æ‰«ææ•°æ®:', this.currentScanData);
			
			var existingIndex = -1;
			for (var i = 0; i < this.scanHistory.length; i++) {
				if (this.scanHistory[i].data === scanData) {
					existingIndex = i;
					break;
				}
			}
			
			if (existingIndex !== -1) {
				console.log('æ‰¾åˆ°ç›¸åŒç¼–ç ï¼Œæ›´æ–°è®¡æ•°');
				this.scanHistory[existingIndex].count++;
				this.scanHistory[existingIndex].lastTime = this.formatDateTime(new Date());
				
				var item = this.scanHistory.splice(existingIndex, 1)[0];
				this.scanHistory.unshift(item);
			} else {
				console.log('æ–°ç¼–ç ï¼Œæ·»åŠ åˆ°å†å²');
				this.scanHistory.unshift({
					data: scanData,
					firstTime: this.formatDateTime(new Date()),
					lastTime: this.formatDateTime(new Date()),
					count: 1
				});
			}
			
			console.log('å½“å‰å†å²è®°å½•æ•°é‡:', this.scanHistory.length);
			
			if (this.settings.sound) {
				uni.showToast({
					title: 'æ‰«ææˆåŠŸ',
					icon: 'success',
					duration: 800
				});
			}
			
			// æ¸…ç©ºè¾“å…¥æ¡†
			this.scanInputValue = '';
			
			console.log('æ‰«æå¤„ç†å®Œæˆ');
		},
		
		/**
		 * ç›‘å¬è¾“å…¥æ¡†è¾“å…¥ï¼ˆåå¤‡æ–¹æ¡ˆï¼‰
		 */
		onScanInput(e) {
			console.log('ğŸ“ è¾“å…¥æ¡†æ¥æ”¶åˆ°æ•°æ®:', e.detail.value);
			this.debugInfo.scanMethod = 'input';
			
			if (this.scanInputTimer) {
				clearTimeout(this.scanInputTimer);
			}
			
			var _this = this;
			this.scanInputTimer = setTimeout(function() {
				var value = e.detail.value.trim();
				if (value) {
					console.log('âœ“ é€šè¿‡è¾“å…¥æ¡†æ¥æ”¶åˆ°æ‰«ææ•°æ®:', value);
					_this.handleScanData(value);
				}
			}, 100);
		},
		
		/**
		 * è¾“å…¥æ¡†ç¡®è®¤
		 */
		onScanConfirm(e) {
			console.log('ğŸ“ è¾“å…¥æ¡†ç¡®è®¤:', e.detail.value);
			var value = e.detail.value.trim();
			if (value) {
				this.handleScanData(value);
			}
		},
		
		/**
		 * æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
		 */
		showDebugInfo() {
			var broadcastList = 'æ— ';
			if (this.debugInfo.broadcastReceived.length > 0) {
				broadcastList = '\n';
				for (var i = 0; i < this.debugInfo.broadcastReceived.length; i++) {
					var item = this.debugInfo.broadcastReceived[i];
					broadcastList += item.time + ': ' + item.action + '\n';
				}
			}
			
			var content = 'æ‰«ææ–¹å¼: ' + this.debugInfo.scanMethod + '\n\n' +
						  'æ¥æ”¶åˆ°çš„å¹¿æ’­:' + broadcastList + '\n' +
						  'æ€»æ‰«ææ¬¡æ•°: ' + this.totalScans + '\n' +
						  'ä¸åŒç¼–ç æ•°: ' + this.uniqueScans;
			
			uni.showModal({
				title: 'è°ƒè¯•ä¿¡æ¯',
				content: content,
				showCancel: true,
				cancelText: 'å¤åˆ¶',
				confirmText: 'å…³é—­',
				success: function(res) {
					if (res.cancel) {
						// å¤åˆ¶åˆ°å‰ªè´´æ¿
						uni.setClipboardData({
							data: content,
							success: function() {
								uni.showToast({
									title: 'å·²å¤åˆ¶',
									icon: 'success'
								});
							}
						});
					}
				}
			});
		},
		
		/**
		 * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
		 */
		formatDateTime(date) {
			var year = date.getFullYear();
			var month = String(date.getMonth() + 1).padStart(2, '0');
			var day = String(date.getDate()).padStart(2, '0');
			var hours = String(date.getHours()).padStart(2, '0');
			var minutes = String(date.getMinutes()).padStart(2, '0');
			var seconds = String(date.getSeconds()).padStart(2, '0');
			
			return year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;
		},
		
		/**
		 * å¼€å¯ç¯å…‰
		 */
		turnOnLight() {
			try {
				plugin.setIllPowerLevel(5);
				plugin.setAim(true);
				this.lightsOn = true;
				console.log('ç¯å…‰å·²è‡ªåŠ¨å¼€å¯');
			} catch (e) {
				console.error('å¼€å¯ç¯å…‰å¤±è´¥:', e);
			}
		},
		
		/**
		 * åˆ‡æ¢ç¯å…‰
		 */
		toggleLights() {
			this.lightsOn = !this.lightsOn;
			
			try {
				if (this.lightsOn) {
					plugin.setIllPowerLevel(5);
					plugin.setAim(true);
					uni.showToast({
						title: 'ç¯å…‰å·²å¼€å¯',
						icon: 'none',
						duration: 1000
					});
				} else {
					plugin.setIllPowerLevel(0);
					plugin.setAim(false);
					uni.showToast({
						title: 'ç¯å…‰å·²å…³é—­',
						icon: 'none',
						duration: 1000
					});
				}
			} catch (e) {
				console.error('åˆ‡æ¢ç¯å…‰å¤±è´¥:', e);
				uni.showToast({
					title: 'ç¯å…‰æ§åˆ¶å¤±è´¥',
					icon: 'none'
				});
			}
		},
		
		/**
		 * æ¸…ç©ºæ•°æ®
		 */
		clearData() {
			var _this = this;
			
			if (this.scanHistory.length === 0 && !this.currentScanData) {
				uni.showToast({
					title: 'æš‚æ— æ•°æ®',
					icon: 'none'
				});
				return;
			}
			
			uni.showModal({
				title: 'ç¡®è®¤æ¸…ç©º',
				content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰«æè®°å½•å—?',
				success: function(res) {
					if (res.confirm) {
						_this.currentScanData = '';
						_this.currentScanTime = '';
						_this.scanHistory = [];
						_this.lastScanData = '';
						_this.lastScanTime = 0;
						_this.scanInputValue = '';
						
						uni.showToast({
							title: 'å·²æ¸…ç©º',
							icon: 'success'
						});
						
						console.log('æ•°æ®å·²æ¸…ç©ºï¼Œå¯ä»¥ç»§ç»­æ‰«æ');
					}
				}
			});
		},
		
		/**
		 * åŠ è½½è®¾ç½®
		 */
		loadSettings() {
			try {
				var savedSettings = uni.getStorageSync('scan_settings');
				if (savedSettings) {
					this.settings = Object.assign({}, this.settings, JSON.parse(savedSettings));
				}
			} catch (e) {
				console.error('åŠ è½½è®¾ç½®å¤±è´¥:', e);
			}
		},
		
		/**
		 * ä¿å­˜è®¾ç½®
		 */
		saveSettings() {
			try {
				uni.setStorageSync('scan_settings', JSON.stringify(this.settings));
			} catch (e) {
				console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', e);
			}
		}
	}
}
</script>

<style lang="scss" scoped>
	/* é¡µé¢å®¹å™¨ */
	.page {
		display: flex;
		flex-direction: column;
		height: 100vh;
		background: #f5f7fa;
		position: relative;
	}
	
	/* éšè—çš„è¾“å…¥æ¡† */
	.hidden-input {
		position: fixed;
		left: -9999px;
		top: -9999px;
		width: 1px;
		height: 1px;
		opacity: 0;
		pointer-events: none;
	}
	
	/* è°ƒè¯•æŒ‰é’® */
	.debug-btn {
		position: fixed;
		right: 30rpx;
		bottom: 100rpx;
		width: 100rpx;
		height: 100rpx;
		background: rgba(64, 158, 255, 0.9);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 50rpx;
		box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.15);
		z-index: 999;
	}
	
	.debug-btn:active {
		transform: scale(0.95);
		background: rgba(64, 158, 255, 1);
	}
	
	/* é¡¶éƒ¨ç»Ÿè®¡æ  */
	.stats-bar {
		display: flex;
		background: white;
		padding: 30rpx;
		box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.06);
	}
	
	.stat-item {
		flex: 1;
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	
	.stat-value {
		font-size: 40rpx;
		font-weight: bold;
		color: #409eff;
		margin-bottom: 8rpx;
	}
	
	.stat-label {
		font-size: 24rpx;
		color: #999;
	}
	
	.stat-divider {
		width: 2rpx;
		height: 60rpx;
		background: #e8e8e8;
		margin: 0 20rpx;
	}
	
	.text-success {
		color: #67c23a !important;
	}
	
	.text-muted {
		color: #909399 !important;
	}
	
	/* ä¸»å†…å®¹åŒº */
	.main-content {
		flex: 1;
		overflow-y: auto;
		padding: 20rpx;
	}
	
	/* æ‰«ææ˜¾ç¤ºå¡ç‰‡ */
	.scan-display-card {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		margin-bottom: 20rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.display-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
	}
	
	.header-left {
		display: flex;
		align-items: center;
	}
	
	.input-icon {
		font-size: 36rpx;
		margin-right: 12rpx;
	}
	
	.input-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.header-right {
		display: flex;
		gap: 16rpx;
	}
	
	/* ç¯å…‰å¼€å…³ */
	.light-switch {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #f5f7fa;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.light-switch:active {
		background: #e4e7ed;
		transform: scale(0.95);
	}
	
	.light-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.light-text {
		font-size: 22rpx;
		color: #666;
	}
	
	/* æ¸…ç©ºæŒ‰é’® */
	.clear-btn {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #fff5f5;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.clear-btn:active {
		background: #fee;
		transform: scale(0.95);
	}
	
	.clear-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.clear-text {
		font-size: 22rpx;
		color: #f56c6c;
	}
	
	/* å½“å‰æ‰«æç»“æœ */
	.current-result {
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		border-radius: 12rpx;
		padding: 24rpx;
	}
	
	.result-content {
		background: rgba(255, 255, 255, 0.15);
		padding: 24rpx;
		border-radius: 8rpx;
		margin-bottom: 16rpx;
	}
	
	.result-data {
		font-size: 32rpx;
		color: white;
		word-break: break-all;
		line-height: 1.6;
		font-weight: 500;
	}
	
	.result-footer {
		text-align: right;
	}
	
	.result-time {
		font-size: 24rpx;
		color: rgba(255, 255, 255, 0.7);
	}
	
	/* ç­‰å¾…æ‰«æçŠ¶æ€ */
	.waiting-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 60rpx 40rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		border: 2rpx dashed #dcdfe6;
	}
	
	.waiting-icon {
		font-size: 80rpx;
		margin-bottom: 20rpx;
		opacity: 0.5;
	}
	
	.waiting-text {
		font-size: 28rpx;
		color: #909399;
		margin-bottom: 12rpx;
		font-weight: 500;
	}
	
	.waiting-hint {
		font-size: 24rpx;
		color: #c0c4cc;
		text-align: center;
		line-height: 1.6;
	}
	
	/* å†å²è®°å½• */
	.history-section {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
		padding-bottom: 20rpx;
		border-bottom: 2rpx solid #f0f0f0;
	}
	
	.section-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.section-count {
		font-size: 24rpx;
		color: #999;
	}
	
	.history-scroll {
		max-height: 600rpx;
	}
	
	.history-card {
		display: flex;
		align-items: center;
		padding: 24rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		margin-bottom: 16rpx;
		transition: all 0.2s;
	}
	
	.history-card:active {
		background: #e9ecef;
		transform: scale(0.98);
	}
	
	.history-number {
		width: 56rpx;
		height: 56rpx;
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		color: white;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24rpx;
		font-weight: bold;
		flex-shrink: 0;
		margin-right: 20rpx;
	}
	
	.history-info {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: center;
		min-width: 0;
	}
	
	.history-data {
		font-size: 28rpx;
		color: #333;
		word-break: break-all;
		margin-bottom: 8rpx;
		line-height: 1.5;
		font-weight: 500;
	}
	
	.history-time {
		font-size: 22rpx;
		color: #999;
		line-height: 1.4;
	}
	
	.history-count {
		flex-shrink: 0;
		margin-left: 16rpx;
		padding: 8rpx 16rpx;
		background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
		border-radius: 20rpx;
	}
	
	.count-text {
		font-size: 24rpx;
		color: white;
		font-weight: bold;
	}
	
	/* ç©ºçŠ¶æ€ */
	.empty-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 120rpx 40rpx;
		background: white;
		border-radius: 16rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.empty-icon {
		font-size: 120rpx;
		margin-bottom: 30rpx;
		opacity: 0.5;
	}
	
	.empty-text {
		font-size: 32rpx;
		color: #666;
		margin-bottom: 16rpx;
		font-weight: 500;
	}
	
	.empty-hint {
		font-size: 26rpx;
		color: #999;
		text-align: center;
		line-height: 1.6;
	}
	
</style>
```

### æ•ˆæœ





### å­˜åœ¨çš„BUG

éƒ½æ²¡æœ‰æ‰«ç çš„å¹¿æ’­   ä¹Ÿå°±å¯¼è‡´äº†æ‰«æå¯èƒ½æ‰«æåˆ°ä¸œè¥¿äº†   ä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥  ä¸èƒ½åƒuhfé‚£æ ·

**ç»è¿‡ä¸€ä¸‹åˆçš„æµ‹ï¼Œnnd   ä¸çŸ¥é“sdkç‰ˆæœ¬å¤ªä½è¿˜æ˜¯å’‹çš„  ï¼Œä½¿ç”¨æ–‡æ¡£æä¾›çš„å¹¿æ’­æ¨¡å¼å°±æ²¡æœ‰ç”Ÿæ•ˆ    è€Œä¸”å…¶è®¾ç½®æ¨¡å¼æ˜¯nmå…¨å±€çš„    æ”¹äº†ä¹‹ååŸæœ¬çš„å°±ç”¨ä¸äº†ï¼ï¼ï¼caao**

## æ··åˆæ¨¡å¼

### ä»£ç 

#### scan-manager-hybrid.js

æ··åˆçš„ï¼Œåˆ°æ—¶å€™éœ€è¦åµŒå…¥åˆ°çœŸå®é¡¹ç›®å½“ä¸­

```js
/**
 * æ‰«ç æ¨¡å—ç®¡ç†å™¨ - æ··åˆæ¨¡å¼
 * å¹¿æ’­ç›‘å¬æŒ‰é”®çŠ¶æ€ + è¾“å…¥æ¡†æ¥æ”¶æ•°æ®ï¼ˆä½†ä¸ä¼šå¼¹å‡ºé”®ç›˜ï¼‰
 */

const plugin = uni.requireNativePlugin('UniScan');

class ScanManager {
	constructor() {
		this.isInitialized = false;
		this.isScanning = false;
		this.lightsOn = false;
		
		// é…ç½®å‚æ•°
		this.config = {
			vibrate: true,
			sound: true,
			scanInterval: 500,
			broadcastAction: "com.pda.keycode.broacast",
			keyCodeKey: "keycode",
			keyStateKey: "isdown",
			scanKeyCode: 292
		};
		
		// å›è°ƒå‡½æ•°
		this.onScanCallback = null;
		this.onKeyScanCallback = null;
		
		// é˜²æŠ–ç›¸å…³
		this.lastScanData = '';
		this.lastScanTime = 0;
		
		// Androidå¹¿æ’­ç›¸å…³
		this.main = null;
		this.receiver = null;
		this.filter = null;
		
		// è¾“å…¥æ¡†ç›¸å…³ - å…³é”®æ”¹è¿›
		this.scanInputTimer = null;
		this.scanInputValue = '';
		this.inputBuffer = '';  // è¾“å…¥ç¼“å†²åŒº
		this.lastInputTime = 0;
		
		// ä¸ä½¿ç”¨ç„¦ç‚¹ç®¡ç†ï¼Œè®©è¾“å…¥æ¡†ä¸€ç›´å­˜åœ¨ä½†ä¸å¯è§
		this.inputElement = null;
	}

	/**
	 * åˆå§‹åŒ–æ‰«ç æ¨¡å—
	 */
	init(config = {}) {
		if (this.isInitialized) {
			console.warn('æ‰«ç æ¨¡å—å·²åˆå§‹åŒ–,è·³è¿‡é‡å¤åˆå§‹åŒ–');
			return true;
		}

		try {
			// æ£€æŸ¥æ‰«ç åŠŸèƒ½æ˜¯å¦å¯ç”¨
			const result = plugin.isOpenScan();
			
			if (!result) {
				console.error('æ‰«ç åŠŸèƒ½æœªå¼€å¯');
				uni.showToast({
					title: 'æ‰«ç åŠŸèƒ½ä¸å¯ç”¨',
					icon: 'none'
				});
				return false;
			}

			// åˆå¹¶é…ç½®
			this.config = { ...this.config, ...config };
			
			// åº”ç”¨é…ç½®
			plugin.setDecodeTipVibrator(this.config.vibrate);
			
			// æ³¨å†ŒæŒ‰é”®ç›‘å¬ï¼ˆåªç”¨äºç›‘å¬æŒ‰é”®çŠ¶æ€ï¼‰
			this.registerKeyListener();
			
			this.isInitialized = true;
			console.log('âœ“ æ‰«ç æ¨¡å—åˆå§‹åŒ–æˆåŠŸ(æ··åˆæ¨¡å¼)', this.config);
			return true;
			
		} catch (e) {
			console.error('âœ— åˆå§‹åŒ–æ‰«ç æ¨¡å—å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * æ³¨å†ŒæŒ‰é”®ç›‘å¬ï¼ˆåªç›‘å¬æŒ‰é”®çŠ¶æ€ï¼‰
	 */
	registerKeyListener() {
		// #ifdef APP-PLUS
		try {
			this.main = plus.android.runtimeMainActivity();
			const IntentFilter = plus.android.importClass('android.content.IntentFilter');
			
			this.filter = new IntentFilter();
			this.filter.addAction(this.config.broadcastAction);
			
			const _this = this;
			this.receiver = plus.android.implements('io.dcloud.feature.internal.reflect.BroadcastReceiver', {
				onReceive: function(context, intent) {
					plus.android.importClass(intent);
					const action = intent.getAction();
					
					if (action === _this.config.broadcastAction) {
						try {
							const keycode = intent.getIntExtra(_this.config.keyCodeKey, 0);
							const isKeyDown = intent.getBooleanExtra(_this.config.keyStateKey, false);
							
							if (keycode === _this.config.scanKeyCode) {
								_this.isScanning = isKeyDown;
								
								if (_this.onKeyScanCallback) {
									_this.onKeyScanCallback(isKeyDown);
								}
								
								console.log(isKeyDown ? 'ğŸ”½ æ‰«æé”®æŒ‰ä¸‹' : 'ğŸ”¼ æ‰«æé”®é‡Šæ”¾');
								
								// æŒ‰é”®é‡Šæ”¾æ—¶ï¼Œå¦‚æœæœ‰ç¼“å†²æ•°æ®ï¼Œç«‹å³å¤„ç†
								if (!isKeyDown && _this.inputBuffer) {
									_this.handleScanData(_this.inputBuffer);
									_this.inputBuffer = '';
								}
							}
						} catch (e) {
							console.log('æ— æŒ‰é”®äº‹ä»¶æ•°æ®');
						}
					}
				}
			});
			
			this.main.registerReceiver(this.receiver, this.filter);
			console.log('âœ“ æŒ‰é”®ç›‘å¬å·²æ³¨å†Œï¼ˆç”¨äºç›‘å¬æ‰«æçŠ¶æ€ï¼‰');
			
		} catch (e) {
			console.error('âœ— æ³¨å†ŒæŒ‰é”®ç›‘å¬å¤±è´¥:', e);
		}
		// #endif
	}

	/**
	 * æ³¨é”€æŒ‰é”®ç›‘å¬
	 */
	unregisterKeyListener() {
		// #ifdef APP-PLUS
		try {
			if (this.main && this.receiver) {
				this.main.unregisterReceiver(this.receiver);
				this.main = null;
				this.receiver = null;
				this.filter = null;
				console.log('âœ“ æŒ‰é”®ç›‘å¬å·²æ³¨é”€');
			}
		} catch (e) {
			console.error('âœ— æ³¨é”€æŒ‰é”®ç›‘å¬å¤±è´¥:', e);
		}
		// #endif
	}

	/**
	 * å¤„ç†æ‰«ç æ•°æ®(å¸¦é˜²æŠ–)
	 */
	handleScanData(scanData) {
		scanData = scanData ? scanData.trim() : '';
		
		if (!scanData) {
			console.log('âŠ— æ‰«ç æ•°æ®ä¸ºç©º');
			return;
		}

		const now = Date.now();
		
		// é˜²æŠ–å¤„ç†
		if (scanData === this.lastScanData && 
			now - this.lastScanTime < this.config.scanInterval) {
			console.log('âŠ— å¿½ç•¥é‡å¤æ‰«æ(é˜²æŠ–)');
			return;
		}
		
		this.lastScanData = scanData;
		this.lastScanTime = now;
		
		// è§¦å‘å›è°ƒ
		if (this.onScanCallback) {
			this.onScanCallback(scanData);
		}
		
		// æç¤ºéŸ³
		if (this.config.sound) {
			uni.showToast({
				title: 'æ‰«ææˆåŠŸ',
				icon: 'success',
				duration: 800
			});
		}
		
		console.log('âœ“ æ‰«ææ•°æ®:', scanData);
	}

	/**
	 * è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶å¤„ç†
	 * æ‰«ç æªè¾“å…¥é€Ÿåº¦å¾ˆå¿«ï¼Œé€šå¸¸åœ¨100mså†…å®Œæˆ
	 */
	onInput(e) {
		const now = Date.now();
		const value = e.detail.value || '';
		
		console.log('ğŸ“ è¾“å…¥æ¡†æ¥æ”¶åˆ°æ•°æ®:', value, 'é•¿åº¦:', value.length);
		
		// å¦‚æœè·ç¦»ä¸Šæ¬¡è¾“å…¥æ—¶é—´å¾ˆçŸ­ï¼ˆæ‰«ç æªç‰¹å¾ï¼‰ï¼Œç´¯ç§¯åˆ°ç¼“å†²åŒº
		if (now - this.lastInputTime < 50) {
			this.inputBuffer = value;
		} else {
			// æ–°çš„è¾“å…¥å¼€å§‹
			this.inputBuffer = value;
		}
		
		this.lastInputTime = now;
		
		// æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
		if (this.scanInputTimer) {
			clearTimeout(this.scanInputTimer);
		}
		
		const _this = this;
		// è¾“å…¥ç»“æŸå150mså¤„ç†æ•°æ®
		this.scanInputTimer = setTimeout(() => {
			console.log('â° å®šæ—¶å™¨è§¦å‘ï¼Œç¼“å†²åŒºæ•°æ®:', _this.inputBuffer);
			if (_this.inputBuffer) {
				_this.handleScanData(_this.inputBuffer);
				_this.inputBuffer = '';
				_this.scanInputValue = ''; // æ¸…ç©ºè¾“å…¥æ¡†
			}
		}, 150);
	}

	/**
	 * è¾“å…¥æ¡†ç¡®è®¤äº‹ä»¶å¤„ç†
	 */
	onConfirm(e) {
		const value = e.detail.value.trim();
		if (value) {
			this.handleScanData(value);
			this.scanInputValue = '';
			this.inputBuffer = '';
		}
	}

	/**
	 * å¼€å¯ç¯å…‰
	 */
	turnOnLight() {
		try {
			plugin.setIllPowerLevel(5);
			plugin.setAim(true);
			this.lightsOn = true;
			console.log('âœ“ ç¯å…‰å·²å¼€å¯');
			return true;
		} catch (e) {
			console.error('âœ— å¼€å¯ç¯å…‰å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * å…³é—­ç¯å…‰
	 */
	turnOffLight() {
		try {
			plugin.setIllPowerLevel(0);
			plugin.setAim(false);
			this.lightsOn = false;
			console.log('âœ“ ç¯å…‰å·²å…³é—­');
			return true;
		} catch (e) {
			console.error('âœ— å…³é—­ç¯å…‰å¤±è´¥:', e);
			return false;
		}
	}

	/**
	 * åˆ‡æ¢ç¯å…‰
	 */
	toggleLight() {
		if (this.lightsOn) {
			this.turnOffLight();
		} else {
			this.turnOnLight();
		}
		return this.lightsOn;
	}

	/**
	 * è®¾ç½®æ‰«ç æ•°æ®å›è°ƒ
	 */
	setOnScanCallback(callback) {
		this.onScanCallback = callback;
	}

	/**
	 * è®¾ç½®æŒ‰é”®å›è°ƒ
	 */
	setOnKeyScanCallback(callback) {
		this.onKeyScanCallback = callback;
	}

	/**
	 * æ›´æ–°é…ç½®
	 */
	updateConfig(config) {
		this.config = { ...this.config, ...config };
		
		if (this.isInitialized && config.vibrate !== undefined) {
			plugin.setDecodeTipVibrator(this.config.vibrate);
		}
	}

	/**
	 * è·å–å½“å‰é…ç½®
	 */
	getCurrentConfig() {
		return { ...this.config };
	}

	/**
	 * æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
	 */
	isReady() {
		return this.isInitialized;
	}

	/**
	 * æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ‰«æ
	 */
	isScanningNow() {
		return this.isScanning;
	}

	/**
	 * æ£€æŸ¥ç¯å…‰çŠ¶æ€
	 */
	isLightOn() {
		return this.lightsOn;
	}

	/**
	 * ååˆå§‹åŒ–
	 */
	uninit() {
		if (!this.isInitialized) return;

		// æ³¨é”€ç›‘å¬
		this.unregisterKeyListener();
		
		// æ¸…é™¤å®šæ—¶å™¨
		if (this.scanInputTimer) {
			clearTimeout(this.scanInputTimer);
			this.scanInputTimer = null;
		}
		
		// å…³é—­ç¯å…‰
		if (this.lightsOn) {
			this.turnOffLight();
		}
		
		// é‡ç½®çŠ¶æ€
		this.isInitialized = false;
		this.isScanning = false;
		this.scanInputValue = '';
		this.inputBuffer = '';
		this.lastInputTime = 0;
		
		console.log('âœ“ æ‰«ç æ¨¡å—å·²ååˆå§‹åŒ–');
	}
}

// å¯¼å‡ºå•ä¾‹
export default new ScanManager();
```

#### retrieval/index.vue

```vue
<template>
	<view class="page">
		<!-- é¡¶éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
		<view class="stats-bar">
			<view class="stat-item">
				<text class="stat-value">{{ totalScans }}</text>
				<text class="stat-label">æ‰«ææ€»æ•°</text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value">{{ uniqueScans }}</text>
				<text class="stat-label">ä¸åŒç¼–ç </text>
			</view>
			<view class="stat-divider"></view>
			<view class="stat-item">
				<text class="stat-value" :class="scanManager.isLightOn() ? 'text-success' : 'text-muted'">
					{{ scanManager.isLightOn() ? 'å·²å¼€å¯' : 'å·²å…³é—­' }}
				</text>
				<text class="stat-label">ç¯å…‰çŠ¶æ€</text>
			</view>
		</view>

		<!-- ä¸»å†…å®¹åŒº -->
		<view class="main-content">
			<!-- æ‰«ææ˜¾ç¤ºåŒºåŸŸ -->
			<view class="scan-display-card">
				<view class="display-header">
					<view class="header-left">
						<text class="input-icon">ğŸ“±</text>
						<text class="input-title">æ‰«æåŒºåŸŸ</text>
					</view>
					<view class="header-right">
						<!-- ç¯å…‰å¼€å…³ -->
						<view class="light-switch" @click="toggleLights">
							<text class="light-icon">{{ scanManager.isLightOn() ? 'ğŸ’¡' : 'ğŸ”¦' }}</text>
							<text class="light-text">{{ scanManager.isLightOn() ? 'å…³ç¯' : 'å¼€ç¯' }}</text>
						</view>
						<!-- æ¸…ç©ºæŒ‰é’® -->
						<view class="clear-btn" @click="clearData">
							<text class="clear-icon">ğŸ—‘ï¸</text>
							<text class="clear-text">æ¸…ç©º</text>
						</view>
					</view>
				</view>
				
				<!-- å½“å‰æ‰«æç»“æœ -->
				<view class="current-result" v-if="currentScanData">
					<view class="result-content">
						<text class="result-data">{{ currentScanData }}</text>
					</view>
					<view class="result-footer">
						<text class="result-time">{{ currentScanTime }}</text>
					</view>
				</view>
				
				<!-- ç­‰å¾…æ‰«æçŠ¶æ€ -->
				<view class="waiting-state" v-else>
					<text class="waiting-icon">ğŸ“·</text>
					<text class="waiting-text">ç­‰å¾…æ‰«æ...</text>
					<text class="waiting-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
				</view>
			</view>
			
			<!-- æ‰«æå†å² -->
			<view class="history-section" v-if="scanHistory.length > 0">
				<view class="section-header">
					<text class="section-title">æ‰«æå†å²</text>
					<text class="section-count">å…± {{ uniqueScans }} ç§ç¼–ç </text>
				</view>
				
				<scroll-view class="history-scroll" scroll-y="true">
					<view 
						class="history-card" 
						v-for="(item, index) in scanHistory" 
						:key="index"
					>
						<view class="history-number">{{ index + 1 }}</view>
						<view class="history-info">
							<text class="history-data">{{ item.data }}</text>
							<text class="history-time">é¦–æ¬¡: {{ item.firstTime }}</text>
							<text class="history-time" v-if="item.count > 1">æœ€è¿‘: {{ item.lastTime }}</text>
						</view>
						<view class="history-count" v-if="item.count > 1">
							<text class="count-text">Ã—{{ item.count }}</text>
						</view>
					</view>
				</scroll-view>
			</view>
			
			<!-- ç©ºçŠ¶æ€ -->
			<view class="empty-state" v-if="!currentScanData && scanHistory.length === 0">
				<text class="empty-icon">ğŸ“¦</text>
				<text class="empty-text">æš‚æ— æ‰«æè®°å½•</text>
				<text class="empty-hint">æŒ‰ä¸‹æ‰‹æŸ„æ‰«æé”®å¼€å§‹æ‰«ææ ‡ç­¾</text>
			</view>
		</view>

		<!-- éšè—çš„è¾“å…¥æ¡†ç”¨äºæ¥æ”¶æ‰«ç æ•°æ® -->
		<input 
			v-model="scanManager.scanInputValue"
			@input="handleScanInput"
			@confirm="handleScanConfirm"
			@focus="handleInputFocus"
			@blur="handleInputBlur"
			type="text"
			class="scan-input"
			:focus="inputFocused"
			:adjust-position="false"
			:cursor-spacing="0"
			confirm-type="done"
		/>
	</view>
</template>

<script>
import ScanManager from '@/common/scan-manager-hybrid'

export default {
	name: 'ScanPage',
	
	data() {
		return {
			scanManager: ScanManager,
			
			// æ‰«ææ•°æ®
			currentScanData: '',
			currentScanTime: '',
			scanHistory: [],
			
			// è¾“å…¥æ¡†ç„¦ç‚¹çŠ¶æ€
			inputFocused: false
		}
	},
	
	computed: {
		totalScans() {
			return this.scanHistory.reduce((sum, item) => sum + item.count, 0);
		},
		uniqueScans() {
			return this.scanHistory.length;
		}
	},
	
	onShow() {
		console.log('é¡µé¢æ˜¾ç¤º - åˆå§‹åŒ–æ‰«ç æ¨¡å—(æ··åˆæ¨¡å¼)');
		
		// åˆå§‹åŒ–é…ç½®
		const config = {
			vibrate: true,
			sound: true,
			scanInterval: 500,
			broadcastAction: "com.pda.keycode.broacast",
			keyCodeKey: "keycode",
			keyStateKey: "isdown",
			scanKeyCode: 292
		};
		
		ScanManager.init(config);
		
		// è®¾ç½®å›è°ƒ
		ScanManager.setOnScanCallback(this.onScanData);
		ScanManager.setOnKeyScanCallback(this.onKeyScan);
		
		// é»˜è®¤å¼€å¯ç¯å…‰
		ScanManager.turnOnLight();
		
		// å…³é”®ï¼šå»¶è¿Ÿèšç„¦è¾“å…¥æ¡†å¹¶éšè—é”®ç›˜
		this.$nextTick(() => {
			setTimeout(() => {
				console.log('ğŸ¯ å‡†å¤‡èšç„¦è¾“å…¥æ¡†');
				this.inputFocused = true;
				
				// ç«‹å³éšè—é”®ç›˜
				setTimeout(() => {
					this.hideKeyboard();
					console.log('âŒ¨ï¸ å·²éšè—é”®ç›˜');
				}, 100);
			}, 300);
		});
	},
	
	onHide() {
		console.log('é¡µé¢éšè— - æ¸…ç†èµ„æº');
		ScanManager.uninit();
	},
	
	onUnload() {
		console.log('é¡µé¢å¸è½½ - å®Œå…¨æ¸…ç†');
		ScanManager.uninit();
	},
	
	methods: {
		/**
		 * æ‰«ç æ•°æ®å›è°ƒ
		 */
		onScanData(data) {
			this.currentScanData = data;
			this.currentScanTime = this.formatDateTime(new Date());
			
			// æŸ¥æ‰¾å†å²è®°å½•
			const existingIndex = this.scanHistory.findIndex(item => item.data === data);
			
			if (existingIndex !== -1) {
				// æ›´æ–°å·²å­˜åœ¨çš„è®°å½•
				this.scanHistory[existingIndex].count++;
				this.scanHistory[existingIndex].lastTime = this.formatDateTime(new Date());
				
				// ç§»åˆ°æœ€å‰é¢
				const item = this.scanHistory.splice(existingIndex, 1)[0];
				this.scanHistory.unshift(item);
			} else {
				// æ·»åŠ æ–°è®°å½•
				this.scanHistory.unshift({
					data: data,
					firstTime: this.formatDateTime(new Date()),
					lastTime: this.formatDateTime(new Date()),
					count: 1
				});
			}
		},
		
		/**
		 * æŒ‰é”®çŠ¶æ€å›è°ƒ
		 */
		onKeyScan(isKeyDown) {
			if (isKeyDown) {
				console.log('æ‰«æé”®æŒ‰ä¸‹');
			} else {
				console.log('æ‰«æé”®é‡Šæ”¾');
			}
		},
		
		/**
		 * è¾“å…¥æ¡†è¾“å…¥å¤„ç†
		 */
		handleScanInput(e) {
			console.log('ğŸ“ Vueæ”¶åˆ°è¾“å…¥äº‹ä»¶');
			ScanManager.onInput(e);
		},
		
		/**
		 * è¾“å…¥æ¡†ç¡®è®¤å¤„ç†
		 */
		handleScanConfirm(e) {
			console.log('âœ… Vueæ”¶åˆ°ç¡®è®¤äº‹ä»¶');
			ScanManager.onConfirm(e);
		},
		
		/**
		 * è¾“å…¥æ¡†èšç„¦å¤„ç†
		 */
		handleInputFocus() {
			console.log('ğŸ‘ï¸ è¾“å…¥æ¡†å·²èšç„¦');
			// ç«‹å³éšè—é”®ç›˜
			setTimeout(() => {
				this.hideKeyboard();
			}, 50);
		},
		
		/**
		 * è¾“å…¥æ¡†å¤±ç„¦å¤„ç†
		 */
		handleInputBlur() {
			console.log('ğŸ‘ï¸â€ğŸ—¨ï¸ è¾“å…¥æ¡†å¤±ç„¦');
			// é‡æ–°èšç„¦
			setTimeout(() => {
				this.inputFocused = false;
				this.$nextTick(() => {
					this.inputFocused = true;
					setTimeout(() => {
						this.hideKeyboard();
					}, 50);
				});
			}, 100);
		},
		
		/**
		 * éšè—é”®ç›˜
		 */
		hideKeyboard() {
			// #ifdef APP-PLUS
			try {
				plus.key.hideSoftKeybord();
			} catch (e) {
				console.log('éšè—é”®ç›˜:', e);
			}
			// #endif
		},
		
		/**
		 * åˆ‡æ¢ç¯å…‰
		 */
		toggleLights() {
			const isOn = ScanManager.toggleLight();
			
			uni.showToast({
				title: isOn ? 'ç¯å…‰å·²å¼€å¯' : 'ç¯å…‰å·²å…³é—­',
				icon: 'none',
				duration: 1000
			});
			
			// ç¡®ä¿è¾“å…¥æ¡†ä¿æŒèšç„¦ä¸”é”®ç›˜éšè—
			this.$nextTick(() => {
				this.inputFocused = false;
				this.$nextTick(() => {
					this.inputFocused = true;
					setTimeout(() => {
						this.hideKeyboard();
					}, 50);
				});
			});
		},
		
		/**
		 * æ¸…ç©ºæ•°æ®
		 */
		clearData() {
			if (this.scanHistory.length === 0 && !this.currentScanData) {
				uni.showToast({
					title: 'æš‚æ— æ•°æ®',
					icon: 'none'
				});
				return;
			}
			
			uni.showModal({
				title: 'ç¡®è®¤æ¸…ç©º',
				content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰«æè®°å½•å—?',
				success: (res) => {
					if (res.confirm) {
						this.currentScanData = '';
						this.currentScanTime = '';
						this.scanHistory = [];
						
						uni.showToast({
							title: 'å·²æ¸…ç©º',
							icon: 'success'
						});
						
						// ç¡®ä¿è¾“å…¥æ¡†ä¿æŒèšç„¦ä¸”é”®ç›˜éšè—
						this.$nextTick(() => {
							this.inputFocused = false;
							this.$nextTick(() => {
								this.inputFocused = true;
								setTimeout(() => {
									this.hideKeyboard();
								}, 50);
							});
						});
					}
				}
			});
		},
		
		/**
		 * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
		 */
		formatDateTime(date) {
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');
			const seconds = String(date.getSeconds()).padStart(2, '0');
			
			return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
		}
	}
}
</script>

<style lang="scss" scoped>
	.page {
		display: flex;
		flex-direction: column;
		height: 100vh;
		background: #f5f7fa;
	}
	
	.scan-input {
		position: fixed;
		left: -9999rpx;
		top: -9999rpx;
		width: 1rpx;
		height: 1rpx;
		opacity: 0;
		z-index: -1;
		pointer-events: none;
		user-select: none;
		-webkit-user-select: none;
	}
	
	.stats-bar {
		display: flex;
		background: white;
		padding: 30rpx;
		box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.06);
	}
	
	.stat-item {
		flex: 1;
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	
	.stat-value {
		font-size: 40rpx;
		font-weight: bold;
		color: #409eff;
		margin-bottom: 8rpx;
	}
	
	.stat-label {
		font-size: 24rpx;
		color: #999;
	}
	
	.stat-divider {
		width: 2rpx;
		height: 60rpx;
		background: #e8e8e8;
		margin: 0 20rpx;
	}
	
	.text-success {
		color: #67c23a !important;
	}
	
	.text-muted {
		color: #909399 !important;
	}
	
	.main-content {
		flex: 1;
		overflow-y: auto;
		padding: 20rpx;
	}
	
	.scan-display-card {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		margin-bottom: 20rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.display-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
	}
	
	.header-left {
		display: flex;
		align-items: center;
	}
	
	.input-icon {
		font-size: 36rpx;
		margin-right: 12rpx;
	}
	
	.input-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.header-right {
		display: flex;
		gap: 16rpx;
	}
	
	.light-switch {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #f5f7fa;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.light-switch:active {
		background: #e4e7ed;
		transform: scale(0.95);
	}
	
	.light-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.light-text {
		font-size: 22rpx;
		color: #666;
	}
	
	.clear-btn {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 12rpx 20rpx;
		background: #fff5f5;
		border-radius: 12rpx;
		transition: all 0.2s;
	}
	
	.clear-btn:active {
		background: #fee;
		transform: scale(0.95);
	}
	
	.clear-icon {
		font-size: 32rpx;
		margin-bottom: 4rpx;
	}
	
	.clear-text {
		font-size: 22rpx;
		color: #f56c6c;
	}
	
	.current-result {
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		border-radius: 12rpx;
		padding: 24rpx;
	}
	
	.result-content {
		background: rgba(255, 255, 255, 0.15);
		padding: 24rpx;
		border-radius: 8rpx;
		margin-bottom: 16rpx;
	}
	
	.result-data {
		font-size: 32rpx;
		color: white;
		word-break: break-all;
		line-height: 1.6;
		font-weight: 500;
	}
	
	.result-footer {
		text-align: right;
	}
	
	.result-time {
		font-size: 24rpx;
		color: rgba(255, 255, 255, 0.7);
	}
	
	.waiting-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 60rpx 40rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		border: 2rpx dashed #dcdfe6;
	}
	
	.waiting-icon {
		font-size: 80rpx;
		margin-bottom: 20rpx;
		opacity: 0.5;
	}
	
	.waiting-text {
		font-size: 28rpx;
		color: #909399;
		margin-bottom: 12rpx;
		font-weight: 500;
	}
	
	.waiting-hint {
		font-size: 24rpx;
		color: #c0c4cc;
		text-align: center;
		line-height: 1.6;
	}
	
	.history-section {
		background: white;
		border-radius: 16rpx;
		padding: 30rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20rpx;
		padding-bottom: 20rpx;
		border-bottom: 2rpx solid #f0f0f0;
	}
	
	.section-title {
		font-size: 32rpx;
		font-weight: bold;
		color: #333;
	}
	
	.section-count {
		font-size: 24rpx;
		color: #999;
	}
	
	.history-scroll {
		max-height: 600rpx;
	}
	
	.history-card {
		display: flex;
		align-items: center;
		padding: 24rpx;
		background: #f8f9fa;
		border-radius: 12rpx;
		margin-bottom: 16rpx;
		transition: all 0.2s;
	}
	
	.history-card:active {
		background: #e9ecef;
		transform: scale(0.98);
	}
	
	.history-number {
		width: 56rpx;
		height: 56rpx;
		background: linear-gradient(135deg, #11cec2 0%, #26736d 100%);
		color: white;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24rpx;
		font-weight: bold;
		flex-shrink: 0;
		margin-right: 20rpx;
	}
	
	.history-info {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: center;
		min-width: 0;
	}
	
	.history-data {
		font-size: 28rpx;
		color: #333;
		word-break: break-all;
		margin-bottom: 8rpx;
		line-height: 1.5;
		font-weight: 500;
	}
	
	.history-time {
		font-size: 22rpx;
		color: #999;
		line-height: 1.4;
	}
	
	.history-count {
		flex-shrink: 0;
		margin-left: 16rpx;
		padding: 8rpx 16rpx;
		background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
		border-radius: 20rpx;
	}
	
	.count-text {
		font-size: 24rpx;
		color: white;
		font-weight: bold;
	}
	
	.empty-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 120rpx 40rpx;
		background: white;
		border-radius: 16rpx;
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
	}
	
	.empty-icon {
		font-size: 120rpx;
		margin-bottom: 30rpx;
		opacity: 0.5;
	}
	
	.empty-text {
		font-size: 32rpx;
		color: #666;
		margin-bottom: 16rpx;
		font-weight: 500;
	}
	
	.empty-hint {
		font-size: 26rpx;
		color: #999;
		text-align: center;
		line-height: 1.6;
	}
</style>
```

### æ•ˆæœ

![image-20251110114052800](21.æ‰«æåœ¨UIDä¸­å®ç°.assets/image-20251110114052800.png)

### å­˜åœ¨çš„BUG

1. æœ€å¼€å§‹è¾“å…¥æ¡†ç±»å‹æ˜¾ç¤ºæ‰«æåˆ°çš„å†…å®¹ï¼Œåˆå§‹åŒ–å¼¹å‡ºé”®ç›˜ï¼Œç°åœ¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨csså»å°†å¼¹å‡ºçš„ç»™éšè—äº†ï¼Œç„¶ååˆå§‹åŒ–çš„æ—¶å€™æ˜¯èšé›†åˆ°è¾“å…¥æ¡†å†…ï¼Œä¹Ÿå°±å¯¼è‡´äº†å¦‚æœç‚¹å‡»åˆ«çš„æŒ‰é’®ï¼šå¦‚æ¸…ç©ºæˆ–è€…å¼€å…³ç¯çš„æ—¶å€™ï¼Œè¾“å…¥æ¡†ä¼šå¤±å»ç„¦ç‚¹ï¼Œè€Œä»£ç ä¼šä½¿å…¶å†æ¬¡èšç„¦ï¼Œæ­¤æ—¶å°±ä¼šé¢‘ç¹å¼¹å‡ºè¾“å…¥æ¡†ï¼Œç„¶åå…³é—­ç­‰ç°è±¡ï¼ï¼























