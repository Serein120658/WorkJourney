# uni-appx

## 页面编写

本来是想学习一下微信快捷登录的流程的，但是中途找到了几个不错的原型图，一时兴起就去做了，也算是回顾一下之前的uni-app知识吧！

**登录页：**

添加了一些基本的判断，和登录成功的跳转页面

![image-20250814150747934](01.技术学习.assets/image-20250814150747934.png)

**我的页面：**

![image-20250814151230757](01.技术学习.assets/image-20250814151230757.png)

### 调整后

**首页：**

![image-20250815111708763](01.技术学习.assets/image-20250815111708763.png)



## 微信快捷登录实现流程？

现在很多的小程序都在使用微信或者电话直接快捷登录

### 微信快捷登录流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant MP as 小程序前端
    participant WX as 微信服务器
    participant BE as 后端服务器
    participant DB as 数据库

U->>MP: 点击微信登录
MP->>U: 弹出授权弹窗
U->>MP: 同意授权
MP->>WX: wx.getUserProfile()获取用户信息
WX->>MP: 返回用户信息(昵称、头像等)
MP->>WX: wx.login()获取临时code
WX->>MP: 返回code
MP->>BE: 发送{code, userInfo}到后端
BE->>WX: 使用code换取openid和session_key
WX->>BE: 返回{openid, session_key, unionid}
BE->>DB: 查询或创建用户
BE->>DB: 保存/更新授权信息
BE->>MP: 返回{token, userInfo}
MP->>MP: 保存token到本地存储
MP->>U: 登录成功，跳转首页
```

### 前端(uni-appx端)

首先需要引入微信SDK

在mainfest.json文件中配置相关的appid

#### 核心代码

```js
uni.login({
        provider: 'weixin',
        success: (res) => {
          console.log('微信登录成功（小程序）:', res);
          resolve(res);
        },
        fail: (err) => {
          console.error('微信登录失败:', err);
          reject(new Error('微信授权失败'));
        }
      });
```

#### 

### 后端

后端的作用主要就是将登录后的微信用户的信息存储起来

## 手机快捷登录

### 手机号快捷登录流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant MP as 小程序前端
    participant BE as 后端服务器
    participant SMS as 短信服务商
    participant DB as 数据库
    participant REDIS as Redis缓存

    U->>MP: 输入手机号
    MP->>BE: 请求发送验证码
    BE->>BE: 验证手机号格式
    BE->>REDIS: 检查发送频率限制
    BE->>SMS: 调用短信接口发送验证码
    SMS->>U: 用户收到短信验证码
    BE->>DB: 保存验证码记录
    BE->>REDIS: 缓存验证码(5分钟)
    BE->>MP: 返回发送成功

    U->>MP: 输入收到的验证码
    MP->>BE: 提交{phone, code}登录
    BE->>DB: 验证验证码
    BE->>DB: 查询或创建用户
    BE->>DB: 标记验证码已使用
    BE->>MP: 返回{token, userInfo}
    MP->>U: 登录成功
```



## 后端如何存储快捷登录的用户信息？



